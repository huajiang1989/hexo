<!doctype html>



  


<html class="theme-next muse use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="About My Work Daily">
<meta property="og:type" content="website">
<meta property="og:title" content="Mr.Hua's Blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Mr.Hua's Blog">
<meta property="og:description" content="About My Work Daily">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Mr.Hua's Blog">
<meta name="twitter:description" content="About My Work Daily">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title> Mr.Hua's Blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Mr.Hua's Blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">To Reload Some Important Article</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Startseite
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archiv
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/07/webpack-module/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Mr.Hua">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Mr.Hua's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Mr.Hua's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/07/webpack-module/" itemprop="url">
                  Webpack配置模块详解
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Veröffentlicht am</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-07T22:00:23+08:00">
                2016-12-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">in</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/webpack/" itemprop="url" rel="index">
                    <span itemprop="name">webpack</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="开始使用webpack"><a href="#开始使用webpack" class="headerlink" title="开始使用webpack"></a>开始使用webpack</h2><p>首先新建一个webpack101的项目，我们将在webpack101这里开展我们接下来的各项学习。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm init // 用于初始化项目的package.json</div></pre></td></tr></table></figure>
<p>//初始化文件目录：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">webpack101</div><div class="line">     src</div><div class="line">         entry.js</div><div class="line">         module1.js</div><div class="line">     index.html</div><div class="line">     package.json</div><div class="line">     webpack.config.js</div></pre></td></tr></table></figure></p>
<h2 id="安装webpack"><a href="#安装webpack" class="headerlink" title="安装webpack"></a>安装webpack</h2><p>我们通过npm来将webpack安装到全局<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install webpack -g</div></pre></td></tr></table></figure></p>
<h2 id="webpack配置"><a href="#webpack配置" class="headerlink" title="webpack配置"></a>webpack配置</h2><p>webpack是需要进行配置的，我们在使用webpack的时候，会默认webpack.config.js为我们的配置文件。所以接下来，我们新建这个js文件。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// webpack.config.js</span></div><div class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">"path"</span>);</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">    <span class="attr">entry</span>: <span class="string">'../src/entry.js'</span>, <span class="comment">//演示单入口文件</span></div><div class="line">    output: &#123;</div><div class="line">        <span class="attr">path</span>: path.join(__dirname, <span class="string">'out'</span>),  <span class="comment">//打包输出的路径</span></div><div class="line">        filename: <span class="string">'bundle.js'</span>,              <span class="comment">//打包后的名字</span></div><div class="line">        publicPath: <span class="string">"./out/"</span>                <span class="comment">//html引用路径，在这里是本地地址。</span></div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>###编写入口文件<br>接下来就编写我们的入口文件entry.js和第一个模块文件module1.js。我们一切从简，里面只用来加载一个Js模块<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// entry.js</span></div><div class="line"><span class="built_in">require</span>(<span class="string">"./module1"</span>); <span class="comment">// 使用CommonJs来加载模块</span></div><div class="line">下一个文件</div></pre></td></tr></table></figure></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// module1.js</span></div><div class="line"><span class="built_in">console</span>.log(<span class="string">"Hello Webpack!"</span>);</div></pre></td></tr></table></figure>
<p>###启动webpack<br>一切准备好后，我们仅需要在项目根目录下，用命令行webpack执行一下即可<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#webpack 命令行的几种基本命令</span></div><div class="line"></div><div class="line">$ webpack    <span class="comment">#最基本的启动webpack方法</span></div><div class="line">$ webpack -w <span class="comment">#提供watch方法，实时进行打包更新</span></div><div class="line">$ webpack -p <span class="comment">#对打包后的文件进行压缩，提供production</span></div><div class="line">$ webpack <span class="_">-d</span> <span class="comment">#提供source map，方便调试。</span></div></pre></td></tr></table></figure></p>
<p>webpack成功运行后，我们就可以看到根目录出现了out文件夹，里面有我们打包生成的bundle.js。我们最后通过在index.html里对这个文件引入就可以了。我们可以在控制台看到我们想要的结果，Hello Webpack !</p>
<p>###多模块依赖<br>刚才的例子，我们仅仅是跑通了webpack通过entry.js入口文件进行打包的例子。下面我们就来看一下它是否真的支持CommonJs和AMD两种模块机制呢？下面我们新建多几个js文件吧！<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 修改module1.js</span></div><div class="line"><span class="built_in">require</span>([<span class="string">"./module3"</span>], <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">"Hello Webpack!"</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>下一个文件<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// module2.js，使用的是CommonJs机制导出包</span></div><div class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> a + b;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>下一个文件<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// module3.js，使用AMD模块机制</span></div><div class="line">define([<span class="string">'./module2.js'</span>], <span class="function"><span class="keyword">function</span>(<span class="params">sum</span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="built_in">console</span>.log(<span class="string">"1 + 2 = "</span> + sum(<span class="number">1</span>, <span class="number">2</span>));</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<p>其实像上面这样混用两种不同机制非常不好，这里仅仅是展示用的，在开发新项目时还是推荐CommonJs或ES2015的Module。当然我个人更倾向于ES2015的模块机制的～</p>
<h2 id="loader加载器"><a href="#loader加载器" class="headerlink" title="loader加载器"></a>loader加载器</h2><p>到了我最喜欢也是最激动人心的功能了！我们先想想应用场景，前端社区有许多预处理器供我们使用。我们可以使用这些预处理器做一些强大的事情，大家都听过的就是CoffeeScript和Sass了。我们以前要编译这些预处理器，就是用gulp进行编译。但是我们对这些文件处理其实也挺繁琐的，webpack可以一次性解决！</p>
<p>在这里我们用Sass和babel编译ES2015为例子，看一下loader是如何使用的</p>
<p>###安装loader</p>
<p>我们第一步就是先要安装好各个必须的loader，我们直接看看需要通过npm安装什么<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install style-loader css-loader url-loader babel-loader sass-loader file-loader --save-dev</div></pre></td></tr></table></figure></p>
<p>###配置loader<br>安装完各个loader后，我们就需要配置一下我们的webpack.config.js，载入我们的loader<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// webpack.config.js</span></div><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">    <span class="attr">entry</span>: path.join(__dirname, <span class="string">'src/entry.js'</span>),</div><div class="line">    <span class="attr">output</span>: &#123;</div><div class="line">        <span class="attr">path</span>: path.join(__dirname, <span class="string">'out'</span>),</div><div class="line">        <span class="attr">publicPath</span>: <span class="string">"./out/"</span>,</div><div class="line">        <span class="attr">filename</span>: <span class="string">'bundle.js'</span></div><div class="line">    &#125;,</div><div class="line">    <span class="comment">// 新添加的module属性</span></div><div class="line">    <span class="built_in">module</span>: &#123;</div><div class="line">        <span class="attr">loaders</span>: [</div><div class="line">            &#123;<span class="attr">test</span>: <span class="regexp">/\.js$/</span>, <span class="attr">loader</span>: <span class="string">"babel"</span>&#125;,</div><div class="line">            &#123;<span class="attr">test</span>: <span class="regexp">/\.css$/</span>, <span class="attr">loader</span>: <span class="string">"style!css"</span>&#125;,</div><div class="line">            &#123;<span class="attr">test</span>: <span class="regexp">/\.(jpgpng)$/</span>, <span class="attr">loader</span>: <span class="string">"url?limit=8192"</span>&#125;,</div><div class="line">            &#123;<span class="attr">test</span>: <span class="regexp">/\.scss$/</span>, <span class="attr">loader</span>: <span class="string">"style!css!sass"</span>&#125;</div><div class="line">        ]</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>我们主要看看module的loaders。loaders是一个数组，里面的每一个对象都用正则表达式，对应着一种配对方案。比如匹配到js后缀名就用babel-loader，匹配到scss后缀名的就先用sass，再用css，最后用style处理，不同的处理器通过!分隔并串联起来。这里的loader是可以省略掉-loader这样的，也就是原本应该写成style-loader!css-loader!sass-loader，当然我们必须惜字如金，所以都去掉后面的东东。</p>
<p>我们仅仅是配置一下，已经是可以直接用ES2015和SASS去写我们的前端代码了。在此之前，我们对src文件夹里再细分成js，css，image三个文件夹，处理好分层。话不多说，赶紧试试。</p>
<h2 id="稍微复杂的webpack项目"><a href="#稍微复杂的webpack项目" class="headerlink" title="稍微复杂的webpack项目"></a>稍微复杂的webpack项目</h2><p>###bebel-loader<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// js/es6-module.js</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">People</span></span>&#123;</div><div class="line">    <span class="keyword">constructor</span>(name)&#123;</div><div class="line">        <span class="keyword">this</span>.name = name;</div><div class="line">    &#125;</div><div class="line">    sayhi()&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">`hi <span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span> !`</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">exports.module = People;</div></pre></td></tr></table></figure></p>
<p>写好模块后，我们直接在entry.js入口文件中引入该模块。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// entry.js</span></div><div class="line"></div><div class="line"><span class="comment">// javascript</span></div><div class="line"><span class="built_in">require</span>(<span class="string">'./js/module1'</span>);</div><div class="line"><span class="keyword">let</span> People = <span class="built_in">require</span>(<span class="string">'./js/es6-module'</span>);</div><div class="line"><span class="keyword">let</span> p = <span class="keyword">new</span> People(<span class="string">"Yika"</span>);</div><div class="line">p.sayHi();</div><div class="line"></div><div class="line"><span class="comment">// css</span></div><div class="line"><span class="built_in">require</span>(<span class="string">'./css/main.scss'</span>);</div></pre></td></tr></table></figure>
<p>哈，不能再爽！这下子我们可以使用很多优秀的ES6特性去构建大型的web了。</p>
<p>###sass-loader<br>大家或许注意到了下方的css的require，那就是用来加载Sass样式的。我们通过启动style-loader会将css代码转化到 style<br>标签内，我们看一下里面的内容<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">// css/main.scss</div><div class="line">html, body&#123;</div><div class="line">    background: #dfdfdf;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>最后我们打开index.html观察我们所有的结果，首先背景已经是淡灰色的，并且控制台也有我们想要的内容。我们通过查看DOM结构，可以发现head标签里多出了style标签，里面正是我们想要定制的样式</p>
<p>###关于对图片的打包</p>
<p>我们之前也说，webpack对与静态资源来说，也是看作模块来加载的。CSS我们是已经看过了，那图片是怎么作为模块打包加载进来呢？这里我们可以想到，图片我们是用url-loader加载的。我们在css文件里的url属性，其实就是一种封装处理过require操作。当然我们还有一种方式就是直接对元素的src属性进行require赋值</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">div</span><span class="selector-class">.img</span>&#123;</div><div class="line">    <span class="attribute">background</span>: <span class="built_in">url</span>(../image/xxx.jpg)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//或者</span></div><div class="line"><span class="keyword">var</span> img = <span class="built_in">document</span>.createElement(<span class="string">"img"</span>);</div><div class="line">img.src = <span class="built_in">require</span>(<span class="string">"../image/xxx.jpg"</span>);</div><div class="line"><span class="built_in">document</span>.body.appendChild(img);</div></pre></td></tr></table></figure>
<p>上述两种方法都会对符合要求的图片进行处理。而要求就是在url-loader后面通过query参数的方式实现的，这里就是说只有不大于8kb的图片才会打包处理成Base64的图片。关于query，请看文档：Query parameters<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;<span class="attr">test</span>: <span class="regexp">/\.(jpgpng)$/</span>, <span class="attr">loader</span>: <span class="string">"url?limit=8192"</span>&#125;</div></pre></td></tr></table></figure></p>
<p>###打包成多个资源文件</p>
<p>我们在开发多页面的站点的时候，还是需要希望能有多个资源文件的。这样我们就可以有效利用缓存提升性能，做到文件按需加载。如何写入口文件，这里就不再赘述了，我们直接看如何对webpack.config.js进行修改</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// webpack.config.js</span></div><div class="line"></div><div class="line">entry: &#123;</div><div class="line">    <span class="attr">page1</span>: <span class="string">"entry.js"</span>,</div><div class="line">    <span class="attr">page2</span>: <span class="string">"entry2.js"</span></div><div class="line">&#125;,</div><div class="line"><span class="attr">output</span>: &#123;</div><div class="line">    <span class="attr">path</span>: path.join(__dirname, <span class="string">'out'</span>),</div><div class="line">    <span class="attr">publicPath</span>: <span class="string">"./out/"</span>,</div><div class="line">    <span class="attr">filename</span>: <span class="string">'[name].js'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这里重点关注两个地方，entry属性可以是一个对象，而对象名也就是key会作为下面output的filename属性的[name]。当然entry也可以是一个数组，更多用法都可以去webpack的官方文档进行查看。</p>
<p>当然webpack也考虑到公共模块的利用，我们利用插件就可以智能提取公共部分，以提供我们浏览器的缓存复用。我们只需要在webpack.config.js添加下面的代码即可</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 修改添加，webpack.config.js</span></div><div class="line"><span class="keyword">var</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</div><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">    <span class="comment">// ....省略各种代码</span></div><div class="line">        plugins: [</div><div class="line">            <span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(<span class="string">'common.js'</span>)</div><div class="line">        ]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>我们做个小测试，让第二个入口文件也加载我们之前的es6-module.js。然后我们用webpack进行打包，就发现生成的common.js里是有相应代码的。我们需要手动在html上去加载common.js，并且是必须要最先加载</p>
<p>###独立出css样式<br>如果我们希望样式通过 link 引入，而不是放在 style 标签内呢，即使这样做会多一个请求。这个时候我们就要配合插件一起使用啦，我们一起来看看<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install extract-text-webpack-plugin --save-dev</div></pre></td></tr></table></figure></p>
<p>安装完插件就要配置webpack.config.js了。我们添加以下代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> ExtractTextPlugin = <span class="built_in">require</span>(<span class="string">"extract-text-webpack-plugin"</span>);</div><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">    <span class="comment">// ...省略各种代码</span></div><div class="line">    <span class="built_in">module</span>: &#123;</div><div class="line">        <span class="attr">loaders</span>: [</div><div class="line">            &#123;<span class="attr">test</span>: <span class="regexp">/\.js$/</span>, <span class="attr">loader</span>: <span class="string">"babel"</span>&#125;,</div><div class="line">            &#123;<span class="attr">test</span>: <span class="regexp">/\.css$/</span>, <span class="attr">loader</span>: ExtractTextPlugin.extract(<span class="string">"style-loader"</span>, <span class="string">"css-loader"</span>)&#125;,</div><div class="line">            &#123;<span class="attr">test</span>: <span class="regexp">/\.(jpgpngsvg)$/</span>, <span class="attr">loader</span>: <span class="string">"url?limit=8192"</span>&#125;,</div><div class="line">            &#123;<span class="attr">test</span>: <span class="regexp">/\.scss$/</span>, <span class="attr">loader</span>: <span class="string">"style!css!sass"</span>&#125;</div><div class="line">        ]</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">plugins</span>: [</div><div class="line">        <span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(<span class="string">'common.js'</span>),</div><div class="line">        <span class="keyword">new</span> ExtractTextPlugin(<span class="string">"[name].css"</span>)</div><div class="line">    ]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/07/webpack-react/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Mr.Hua">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Mr.Hua's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Mr.Hua's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/07/webpack-react/" itemprop="url">
                  Webpack与react
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Veröffentlicht am</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-07T21:52:06+08:00">
                2016-12-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">in</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/webpack/" itemprop="url" rel="index">
                    <span itemprop="name">webpack</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="webpack特性"><a href="#webpack特性" class="headerlink" title="webpack特性"></a>webpack特性</h2><p>webpack具有requireJs和browserify的功能，但仍有很多自己的新特性：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">1. 对 CommonJS 、 AMD 、ES6的语法做了兼容</div><div class="line">2. 对js、css、图片等资源文件都支持打包</div><div class="line">3. 串联式模块加载器以及插件机制，让其具有更好的灵活性和扩展性，例如提供对CoffeeScript、ES6的支持</div><div class="line">4. 有独立的配置文件webpack.config.js</div><div class="line">5. 可以将代码切割成不同的chunk，实现按需加载，降低了初始化时间</div><div class="line">6. 支持 SourceUrls 和 SourceMaps，易于调试</div><div class="line">7. 具有强大的Plugin接口，大多是内部插件，使用起来比较灵活</div><div class="line">8.webpack 使用异步 IO 并具有多级缓存。这使得 webpack 很快且在增量编译上更加快</div></pre></td></tr></table></figure></p>
<h2 id="React-sample"><a href="#React-sample" class="headerlink" title="React-sample"></a>React-sample</h2><p>以 react-sample 为例，简单说明 webpack 如何打包一个 React 组件，其目录结构如下：</p>
<p>其中Hello.js定义了一个简单的React组件，使用ES6语法：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by pomy on 15/11/4.</div><div class="line"> */</div><div class="line"></div><div class="line"><span class="keyword">import</span> React, &#123;Component&#125; <span class="keyword">from</span> <span class="string">'react'</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Hello</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</div><div class="line">    render()&#123;</div><div class="line">        <span class="keyword">return</span> (</div><div class="line">            &lt;div&gt;Hello, &#123;this.props.name&#125;!&lt;/div&gt;</div><div class="line">        );</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>entry.js是入口文件，将一个Hello组件输出到界面：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by pomy on 15/11/4.</div><div class="line"> */</div><div class="line"></div><div class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</div><div class="line"><span class="keyword">import</span> Hello <span class="keyword">from</span> <span class="string">'./hello'</span>;</div><div class="line"></div><div class="line">React.render(&lt;Hello name="Nate" /&gt;, document.body);</div></pre></td></tr></table></figure></p>
<p>index.html的内容如下：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>React Sample<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./assets/bundle.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>webpack.config.js文件通常放在项目的根目录中，它本身也是一个标准的Commonjs规范的模块：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by pomy on 15/11/4.</div><div class="line"> */</div><div class="line"></div><div class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">    <span class="attr">entry</span>: path.resolve(__dirname, <span class="string">'./src/entry.js'</span>),</div><div class="line">    <span class="attr">output</span>: &#123;</div><div class="line">        <span class="attr">path</span>: path.resolve(__dirname, <span class="string">'./assets'</span>),</div><div class="line">        <span class="attr">filename</span>: <span class="string">'bundle.js'</span></div><div class="line">    &#125;,</div><div class="line"></div><div class="line">    <span class="attr">module</span>: &#123;</div><div class="line">        <span class="attr">loaders</span>: [</div><div class="line">            &#123; <span class="attr">test</span>: <span class="regexp">/\.js?$/</span>, <span class="attr">loaders</span>: [<span class="string">'babel'</span>], <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span> &#125;,</div><div class="line">            &#123; <span class="attr">test</span>: <span class="regexp">/\.js$/</span>, <span class="attr">loader</span>: <span class="string">'babel-loader'</span>, <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>&#125;</div><div class="line">        ]</div><div class="line">    &#125;,</div><div class="line"></div><div class="line">    <span class="attr">resolve</span>:&#123;</div><div class="line">        <span class="attr">extensions</span>:[<span class="string">''</span>,<span class="string">'.js'</span>,<span class="string">'.json'</span>]</div><div class="line">    &#125;,</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>整个代码在 这里，clone之后，切换到react-sample目录下，在终端运行 npm i &amp;&amp; npm run build 进行打包，打包后的文件名是 bundle.js， 所在相对目录是 /assets。至此，webpack打包过程就Ok了。</p>
<h2 id="Webpack安装和配置"><a href="#Webpack安装和配置" class="headerlink" title="Webpack安装和配置"></a>Webpack安装和配置</h2><p>##安装</p>
<p>webpack 可以作为全局的npm模块安装，也可以在当前项目中安装。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">npm install -g webpack</div><div class="line">npm install --save-dev webpack</div></pre></td></tr></table></figure></p>
<p>对于全局安装的webpack，直接执行此命令会默认使用当前目录的webpack.config.js作为配置文件。如果要指定另外的配置文件，可以执行：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">webpack —config webpack.custom.config.js</div></pre></td></tr></table></figure></p>
<p>##配置</p>
<p>每个项目下都必须配置有一个 webpack.config.js ，它的作用如同常规的 gulpfile.js/Gruntfile.js ，就是一个配置项，告诉 webpack 它需要做什么。</p>
<p>前文说了，webpack.config.js文件通常放在项目的根目录中，它本身也是一个标准的Commonjs规范的模块。在导出的配置对象中有几个关键的参数：</p>
<p>##entry</p>
<p>entry参数定义了打包后的入口文件，可以是个字符串或数组或者是对象；如果是数组，数组中的所有文件会打包生成一个filename文件；如果是对象，可以将不同的文件构建成不同的文件:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">entry</span>: &#123;</div><div class="line">        <span class="attr">page1</span>: <span class="string">"./page1"</span>,</div><div class="line"></div><div class="line">        <span class="comment">//支持数组形式，将加载数组中的所有模块，但以最后一个模块作为输出</span></div><div class="line">        page2: [<span class="string">"./entry1"</span>, <span class="string">"./entry2"</span>]</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">output</span>: &#123;</div><div class="line">        <span class="attr">path</span>: <span class="string">"dist/js/page"</span>,</div><div class="line">        <span class="attr">publicPath</span>: <span class="string">"/output/"</span>,</div><div class="line">        <span class="attr">filename</span>: <span class="string">"[name].bundle.js"</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>该段代码最终会生成一个 page1.bundle.js 和 page2.bundle.js，并存放到 ./dist/js/page 文件夹下</p>
<p>##output</p>
<p>output参数是个对象，定义了输出文件的位置及名字：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">output: &#123;</div><div class="line">        <span class="attr">path</span>: <span class="string">"dist/js/page"</span>,</div><div class="line">        <span class="attr">publicPath</span>: <span class="string">"/output/"</span>,</div><div class="line">        <span class="attr">filename</span>: <span class="string">"[name].bundle.js"</span></div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">path: 打包文件存放的绝对路径</div><div class="line">publicPath: 网站运行时的访问路径</div><div class="line">filename:打包后的文件名</div></pre></td></tr></table></figure>
<p>当我们在entry中定义构建多个文件时，filename可以对应的更改为[name].js用于定义不同文件构建后的名字。</p>
<p>##module</p>
<p>在webpack中JavaScript，CSS，LESS，TypeScript，JSX，CoffeeScript，图片等静态文件都是模块，不同模块的加载是通过模块加载器（webpack-loader）来统一管理的。loaders之间是可以串联的，一个加载器的输出可以作为下一个加载器的输入，最终返回到JavaScript上：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">module</span>: &#123;</div><div class="line">        <span class="comment">//加载器配置</span></div><div class="line">        loaders: [</div><div class="line">            <span class="comment">//.css 文件使用 style-loader 和 css-loader 来处理</span></div><div class="line">            &#123; <span class="attr">test</span>: <span class="regexp">/\.css$/</span>, <span class="attr">loader</span>: <span class="string">'style-loader!css-loader'</span> &#125;,</div><div class="line"></div><div class="line">            <span class="comment">//.js 文件使用 jsx-loader 来编译处理</span></div><div class="line">            &#123; <span class="attr">test</span>: <span class="regexp">/\.js$/</span>, <span class="attr">loader</span>: <span class="string">'jsx-loader?harmony'</span> &#125;,</div><div class="line"></div><div class="line">            <span class="comment">//.scss 文件使用 style-loader、css-loader 和 sass-loader 来编译处理</span></div><div class="line">            &#123; <span class="attr">test</span>: <span class="regexp">/\.scss$/</span>, <span class="attr">loader</span>: <span class="string">'style!css!sass?sourceMap'</span>&#125;,</div><div class="line"></div><div class="line">            <span class="comment">//图片文件使用 url-loader 来处理，小于8kb的直接转为base64</span></div><div class="line">            &#123; <span class="attr">test</span>: <span class="regexp">/\.(png|jpg)$/</span>, <span class="attr">loader</span>: <span class="string">'url-loader?limit=8192'</span>&#125;</div><div class="line">        ]</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>test项表示匹配的资源类型，loader或loaders项表示用来加载这种类型的资源的loader，loader的使用可以参考 using loaders，更多的loader可以参考 list of loaders。</p>
<p>！用来定义loader的串联关系，”-loader”是可以省略不写的，多个loader之间用“!”连接起来，但所有的加载器都需要通过 npm 来加载。</p>
<p>此外，还可以添加用来定义png、jpg这样的图片资源在小于10k时自动处理为base64图片的加载器：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123; <span class="attr">test</span>: <span class="regexp">/\.(png|jpg)$/</span>,<span class="attr">loader</span>: <span class="string">'url-loader?limit=10000'</span>&#125;</div></pre></td></tr></table></figure></p>
<p>给css和less还有图片添加了loader之后，我们不仅可以像在node中那样require js文件了，我们还可以require css、less甚至图片文件：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">require</span>(<span class="string">'./bootstrap.css'</span>);</div><div class="line"><span class="built_in">require</span>(<span class="string">'./myapp.less'</span>);</div><div class="line"><span class="keyword">var</span> img = <span class="built_in">document</span>.createElement(<span class="string">'img'</span>);</div><div class="line">img.src = <span class="built_in">require</span>(<span class="string">'./glyph.png'</span>);</div></pre></td></tr></table></figure></p>
<p>注意，require()还支持在资源path前面指定loader，即require(![loaders list]![source path])形式：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">require</span>(<span class="string">"!style!css!less!bootstrap/less/bootstrap.less"</span>);</div><div class="line"><span class="comment">// “bootstrap.less”这个资源会先被"less-loader"处理，</span></div><div class="line"><span class="comment">// 其结果又会被"css-loader"处理，接着是"style-loader"</span></div><div class="line"><span class="comment">// 可类比pipe操作</span></div></pre></td></tr></table></figure></p>
<p>require()时指定的loader会覆盖配置文件里对应的loader配置项。</p>
<p>##resolve</p>
<p>webpack在构建包的时候会按目录的进行文件的查找，resolve属性中的extensions数组中用于配置程序可以自行补全哪些文件后缀：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">resolve: &#123;</div><div class="line">       <span class="comment">//查找module的话从这里开始查找</span></div><div class="line">       root: <span class="string">'/pomy/github/flux-example/src'</span>, <span class="comment">//绝对路径</span></div><div class="line"></div><div class="line">       <span class="comment">//自动扩展文件后缀名，意味着我们require模块可以省略不写后缀名</span></div><div class="line">       extensions: [<span class="string">''</span>, <span class="string">'.js'</span>, <span class="string">'.json'</span>, <span class="string">'.scss'</span>],</div><div class="line"></div><div class="line">       <span class="comment">//模块别名定义，方便后续直接引用别名，无须多写长长的地址</span></div><div class="line">       alias: &#123;</div><div class="line">           <span class="attr">AppStore</span> : <span class="string">'js/stores/AppStores.js'</span>,<span class="comment">//后续直接 require('AppStore') 即可</span></div><div class="line">           ActionType : <span class="string">'js/actions/ActionType.js'</span>,</div><div class="line">           <span class="attr">AppAction</span> : <span class="string">'js/actions/AppAction.js'</span></div><div class="line">       &#125;</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<p>然后我们想要加载一个js文件时，只要require(‘common’)就可以加载common.js文件了。</p>
<p>注意一下, extensions 第一个是空字符串! 对应不需要后缀的情况.</p>
<p>##plugin</p>
<p>webpack提供了[丰富的组件]用来满足不同的需求，当然我们也可以自行实现一个组件来满足自己的需求：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">plugins: [</div><div class="line">     <span class="comment">//your plugins list</span></div><div class="line"> ]</div></pre></td></tr></table></figure></p>
<p>在webpack中编写js文件时，可以通过require的方式引入其他的静态资源，可通过loader对文件自动解析并打包文件。通常会将js文件打包合并，css文件会在页面的header中嵌入style的方式载入页面。但开发过程中我们并不想将样式打在脚本中，最好可以独立生成css文件，以外链的形式加载。这时extract-text-webpack-plugin插件可以帮我们达到想要的效果。需要使用npm的方式加载插件，然后参见下面的配置，就可以将js中的css文件提取，并以指定的文件名来进行加载。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install extract-text-webpack-plugin –save-dev</div></pre></td></tr></table></figure></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">plugins: [</div><div class="line">    <span class="keyword">new</span> ExtractTextPlugin(<span class="string">'styles.css'</span>)</div><div class="line">]</div></pre></td></tr></table></figure>
<p>##externals</p>
<p>当我们想在项目中require一些其他的类库或者API，而又不想让这些类库的源码被构建到运行时文件中，这在实际开发中很有必要。此时我们就可以通过配置externals参数来解决这个问题：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">externals: &#123;</div><div class="line">    <span class="string">"jquery"</span>: <span class="string">"jQuery"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这样我们就可以放心的在项目中使用这些API了：var jQuery = require(“jquery”);</p>
<p>##context</p>
<p>当我们在require一个模块的时候，如果在require中包含变量，像这样：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">require</span>(<span class="string">"./mods/"</span> + name + <span class="string">".js"</span>);</div></pre></td></tr></table></figure></p>
<p>那么在编译的时候我们是不能知道具体的模块的。但这个时候，webpack也会为我们做些分析工作：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">1.分析目录：<span class="string">'./mods'</span>；</div><div class="line">2.提取正则表达式：<span class="string">'/^.*\.js$/'</span>；</div></pre></td></tr></table></figure></p>
<p>于是这个时候为了更好地配合wenpack进行编译，我们可以给它指明路径，像在cake-webpack-config中所做的那样（我们在这里先忽略abcoption的作用）：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> currentBase = process.cwd();</div><div class="line"><span class="keyword">var</span> context = abcOptions.options.context ? abcOptions.options.context :</div><div class="line">path.isAbsolute(entryDir) ? entryDir : path.join(currentBase, entryDir);</div></pre></td></tr></table></figure></p>
<p>关于 webpack.config.js 更详尽的配置可以参考这里</p>
<h2 id="webpack常用命令"><a href="#webpack常用命令" class="headerlink" title="webpack常用命令"></a>webpack常用命令</h2><p>##webpack的使用通常有三种方式：</p>
<p>1、命令行使用：webpack <entry.js> <result.js> 其中entry.js是入口文件，result.js是打包后的输出文件<br>2、node.js API使用：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</div><div class="line">webpack(&#123;</div><div class="line"><span class="comment">//configuration</span></div><div class="line">&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err, stats</span>)</span>&#123;&#125;);</div></pre></td></tr></table></figure></result.js></entry.js></p>
<p>3、默认使用当前目录的webpack.config.js作为配置文件。如果要指定另外的配置文件，可以执行：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">webpack --config webpack.custom.config.js</div></pre></td></tr></table></figure></p>
<p>webpack 的执行也很简单，直接执行<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ webpack --display-error-details</div></pre></td></tr></table></figure></p>
<p>即可，后面的参数“–display-error-details”是推荐加上的，方便出错时能查阅更详尽的信息（比如 webpack 寻找模块的过程），从而更好定位到问题。<br>常用命令<br>webpack的使用和browserify有些类似，下面列举几个常用命令：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">webpack    <span class="comment">#最基本的启动webpack命令</span></div><div class="line">webpack -w <span class="comment">#提供watch方法，实时进行打包更新</span></div><div class="line">webpack -p <span class="comment">#对打包后的文件进行压缩</span></div><div class="line">webpack <span class="_">-d</span> <span class="comment">#提供SourceMaps，方便调试</span></div><div class="line">webpack --colors <span class="comment">#输出结果带彩色，比如：会用红色显示耗时较长的步骤</span></div><div class="line">webpack --profile <span class="comment">#输出性能数据，可以看到每一步的耗时</span></div><div class="line">webpack --display-modules <span class="comment">#默认情况下 node_modules 下的模块会被隐藏，加上这个参数可以显示这些被隐藏的模块</span></div></pre></td></tr></table></figure></p>
<p>前面的四个命令比较基础，使用频率会比较大，后面的命令主要是用来定位打包时间较长的原因，方便改进配置文件，提高打包效率。</p>
<h2 id="图片打包和静态资源服务器"><a href="#图片打包和静态资源服务器" class="headerlink" title="图片打包和静态资源服务器"></a>图片打包和静态资源服务器</h2><p>##图片打包</p>
<p>webpack中对于图片的处理，可以通过url-loader来实现图片的压缩。<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">div</span><span class="selector-class">.img</span>&#123;</div><div class="line">    <span class="attribute">background</span>: <span class="built_in">url</span>(../image/xxx.jpg)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//或者</span></div><div class="line"><span class="keyword">var</span> img = <span class="built_in">document</span>.createElement(<span class="string">"img"</span>);</div><div class="line">img.src = <span class="built_in">require</span>(<span class="string">"../image/xxx.jpg"</span>);</div><div class="line"><span class="built_in">document</span>.body.appendChild(img);</div></pre></td></tr></table></figure>
<p>针对上面的两种使用方式，loader可以自动识别并处理。根据loader中的设置，webpack会将小于指点大小的文件转化成 base64 格式的 dataUrl，其他图片会做适当的压缩并存放在指定目录中。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">module</span>: &#123;</div><div class="line">    &#123;</div><div class="line">      <span class="attr">test</span>: <span class="regexp">/\.(png|jpg)$/</span>,</div><div class="line">      <span class="attr">loader</span>: <span class="string">'url-loader?limit=10000&amp;name=build/[name].[ext]'</span></div><div class="line">    &#125;]</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>对于上面的配置，如果图片资源小于10kb就会转化成 base64 格式的 dataUrl，其他的图片会存放在build/文件夹下。</p>
<p>##静态资源服务器</p>
<p>除了提供模块打包功能，Webpack还提供了一个基于Node.js Express框架的开发服务器，它是一个静态资源Web服务器，对于简单静态页面或者仅依赖于独立服务的前端页面，都可以直接使用这个开发服务器进行开发。在开发过程中，开发服务器会监听每一个文件的变化，进行实时打包，并且可以推送通知前端页面代码发生了变化，从而可以实现页面的自动刷新。</p>
<p>Webpack开发服务器需要单独安装，同样是通过npm进行：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install -g webpack-dev-server</div></pre></td></tr></table></figure></p>
<p>可以使用webpack-dev-server直接启动，也可以增加参数来获取更多的功能，具体配置可以参见官方文档。默认启动端口8080，通过localhost:8080/webpack-dev-server/可以访问页面，文件修改后保存时会在页面头部看到sever的状态变化，并且会进行热替换，实现页面的自动刷新。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/07/zhengze/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Mr.Hua">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Mr.Hua's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Mr.Hua's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/07/zhengze/" itemprop="url">
                  正则表达式
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Veröffentlicht am</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-07T21:33:33+08:00">
                2016-12-07
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div><div class="line">364</div><div class="line">365</div><div class="line">366</div><div class="line">367</div><div class="line">368</div><div class="line">369</div><div class="line">370</div><div class="line">371</div><div class="line">372</div><div class="line">373</div><div class="line">374</div><div class="line">375</div><div class="line">376</div><div class="line">377</div><div class="line">378</div><div class="line">379</div><div class="line">380</div><div class="line">381</div><div class="line">382</div><div class="line">383</div><div class="line">384</div><div class="line">385</div><div class="line">386</div><div class="line">387</div><div class="line">388</div><div class="line">389</div><div class="line">390</div><div class="line">391</div><div class="line">392</div><div class="line">393</div><div class="line">394</div><div class="line">395</div><div class="line">396</div><div class="line">397</div><div class="line">398</div><div class="line">399</div><div class="line">400</div><div class="line">401</div><div class="line">402</div><div class="line">403</div><div class="line">404</div><div class="line">405</div><div class="line">406</div><div class="line">407</div><div class="line">408</div><div class="line">409</div><div class="line">410</div><div class="line">411</div><div class="line">412</div><div class="line">413</div><div class="line">414</div><div class="line">415</div><div class="line">416</div><div class="line">417</div><div class="line">418</div><div class="line">419</div><div class="line">420</div><div class="line">421</div><div class="line">422</div><div class="line">423</div><div class="line">424</div><div class="line">425</div><div class="line">426</div><div class="line">427</div><div class="line">428</div><div class="line">429</div><div class="line">430</div><div class="line">431</div><div class="line">432</div><div class="line">433</div><div class="line">434</div><div class="line">435</div><div class="line">436</div><div class="line">437</div><div class="line">438</div><div class="line">439</div><div class="line">440</div><div class="line">441</div><div class="line">442</div><div class="line">443</div><div class="line">444</div><div class="line">445</div><div class="line">446</div><div class="line">447</div><div class="line">448</div><div class="line">449</div><div class="line">450</div><div class="line">451</div><div class="line">452</div><div class="line">453</div><div class="line">454</div><div class="line">455</div><div class="line">456</div><div class="line">457</div><div class="line">458</div><div class="line">459</div><div class="line">460</div><div class="line">461</div><div class="line">462</div><div class="line">463</div><div class="line">464</div><div class="line">465</div><div class="line">466</div><div class="line">467</div><div class="line">468</div><div class="line">469</div><div class="line">470</div><div class="line">471</div><div class="line">472</div><div class="line">473</div><div class="line">474</div><div class="line">475</div><div class="line">476</div><div class="line">477</div><div class="line">478</div><div class="line">479</div><div class="line">480</div><div class="line">481</div><div class="line">482</div><div class="line">483</div><div class="line">484</div><div class="line">485</div><div class="line">486</div><div class="line">487</div><div class="line">488</div><div class="line">489</div><div class="line">490</div><div class="line">491</div><div class="line">492</div><div class="line">493</div><div class="line">494</div><div class="line">495</div><div class="line">496</div><div class="line">497</div><div class="line">498</div><div class="line">499</div><div class="line">500</div><div class="line">501</div><div class="line">502</div><div class="line">503</div><div class="line">504</div><div class="line">505</div><div class="line">506</div><div class="line">507</div><div class="line">508</div><div class="line">509</div><div class="line">510</div><div class="line">511</div><div class="line">512</div><div class="line">513</div><div class="line">514</div><div class="line">515</div><div class="line">516</div><div class="line">517</div><div class="line">518</div><div class="line">519</div><div class="line">520</div><div class="line">521</div><div class="line">522</div><div class="line">523</div><div class="line">524</div><div class="line">525</div><div class="line">526</div><div class="line">527</div><div class="line">528</div><div class="line">529</div><div class="line">530</div><div class="line">531</div><div class="line">532</div><div class="line">533</div><div class="line">534</div><div class="line">535</div><div class="line">536</div><div class="line">537</div><div class="line">538</div><div class="line">539</div><div class="line">540</div><div class="line">541</div><div class="line">542</div><div class="line">543</div><div class="line">544</div><div class="line">545</div><div class="line">546</div><div class="line">547</div><div class="line">548</div><div class="line">549</div><div class="line">550</div><div class="line">551</div><div class="line">552</div><div class="line">553</div><div class="line">554</div><div class="line">555</div><div class="line">556</div><div class="line">557</div><div class="line">558</div><div class="line">559</div><div class="line">560</div><div class="line">561</div><div class="line">562</div><div class="line">563</div><div class="line">564</div><div class="line">565</div><div class="line">566</div><div class="line">567</div><div class="line">568</div><div class="line">569</div><div class="line">570</div><div class="line">571</div><div class="line">572</div><div class="line">573</div><div class="line">574</div><div class="line">575</div><div class="line">576</div><div class="line">577</div><div class="line">578</div><div class="line">579</div><div class="line">580</div><div class="line">581</div><div class="line">582</div><div class="line">583</div><div class="line">584</div><div class="line">585</div><div class="line">586</div><div class="line">587</div><div class="line">588</div><div class="line">589</div></pre></td><td class="code"><pre><div class="line">1.正则表达式基本语法</div><div class="line"></div><div class="line"></div><div class="line">两个特殊的符号<span class="string">'^'</span>和<span class="string">'$'</span>。他们的作用是分别指出一个字符串的开始和结束。例子如下：</div><div class="line"></div><div class="line"><span class="string">"^The"</span>：表示所有以<span class="string">"The"</span>开始的字符串（<span class="string">"There"</span>，<span class="string">"The cat"</span>等）；</div><div class="line"><span class="string">"of despair$"</span>：表示所以以<span class="string">"of despair"</span>结尾的字符串；</div><div class="line"><span class="string">"^abc$"</span>：表示开始和结尾都是<span class="string">"abc"</span>的字符串——呵呵，只有<span class="string">"abc"</span>自己了；</div><div class="line"><span class="string">"notice"</span>：表示任何包含<span class="string">"notice"</span>的字符串。</div><div class="line"></div><div class="line">象最后那个例子，如果你不使用两个特殊字符，你就在表示要查找的串在被查找串的任意部分——你并</div><div class="line">不把它定位在某一个顶端。</div><div class="line"></div><div class="line">其它还有<span class="string">'*'</span>，<span class="string">'+'</span>和<span class="string">'?'</span>这三个符号，表示一个或一序列字符重复出现的次数。它们分别表示“没有或</div><div class="line">更多”，“一次或更多”还有“没有或一次”。下面是几个例子：</div><div class="line"></div><div class="line"><span class="string">"ab*"</span>：表示一个字符串有一个a后面跟着零个或若干个b。（<span class="string">"a"</span>, <span class="string">"ab"</span>, <span class="string">"abbb"</span>,……）；</div><div class="line"><span class="string">"ab+"</span>：表示一个字符串有一个a后面跟着至少一个b或者更多；</div><div class="line"><span class="string">"ab?"</span>：表示一个字符串有一个a后面跟着零个或者一个b；</div><div class="line"><span class="string">"a?b+$"</span>：表示在字符串的末尾有零个或一个a跟着一个或几个b。</div><div class="line"></div><div class="line">你也可以使用范围，用大括号括起，用以表示重复次数的范围。</div><div class="line"></div><div class="line"><span class="string">"ab&#123;2&#125;"</span>：表示一个字符串有一个a跟着2个b（<span class="string">"abb"</span>）；</div><div class="line"><span class="string">"ab&#123;2,&#125;"</span>：表示一个字符串有一个a跟着至少2个b；</div><div class="line"><span class="string">"ab&#123;3,5&#125;"</span>：表示一个字符串有一个a跟着3到5个b。</div><div class="line"></div><div class="line">请注意，你必须指定范围的下限（如：<span class="string">"&#123;0,2&#125;"</span>而不是<span class="string">"&#123;,2&#125;"</span>）。还有，你可能注意到了，<span class="string">'*'</span>，<span class="string">'+'</span>和</div><div class="line"><span class="string">'?'</span>相当于<span class="string">"&#123;0,&#125;"</span>，<span class="string">"&#123;1,&#125;"</span>和<span class="string">"&#123;0,1&#125;"</span>。</div><div class="line">还有一个<span class="string">'¦'</span>，表示“或”操作：</div><div class="line"></div><div class="line"><span class="string">"hi¦hello"</span>：表示一个字符串里有<span class="string">"hi"</span>或者<span class="string">"hello"</span>；</div><div class="line"><span class="string">"(b¦cd)ef"</span>：表示<span class="string">"bef"</span>或<span class="string">"cdef"</span>；</div><div class="line"><span class="string">"(a¦b)*c"</span>：表示一串<span class="string">"a"</span><span class="string">"b"</span>混合的字符串后面跟一个<span class="string">"c"</span>；</div><div class="line"></div><div class="line"><span class="string">'.'</span>可以替代任何字符：</div><div class="line"></div><div class="line"><span class="string">"a.[0-9]"</span>：表示一个字符串有一个<span class="string">"a"</span>后面跟着一个任意字符和一个数字；</div><div class="line"><span class="string">"^.&#123;3&#125;$"</span>：表示有任意三个字符的字符串（长度为3个字符）；</div><div class="line"></div><div class="line">方括号表示某些字符允许在一个字符串中的某一特定位置出现：</div><div class="line"></div><div class="line"><span class="string">"[ab]"</span>：表示一个字符串有一个<span class="string">"a"</span>或<span class="string">"b"</span>（相当于<span class="string">"a¦b"</span>）；</div><div class="line"><span class="string">"[a-d]"</span>：表示一个字符串包含小写的<span class="string">'a'</span>到<span class="string">'d'</span>中的一个（相当于<span class="string">"a¦b¦c¦d"</span>或者<span class="string">"[abcd]"</span>）；</div><div class="line"><span class="string">"^[a-zA-Z]"</span>：表示一个以字母开头的字符串；</div><div class="line"><span class="string">"[0-9]%"</span>：表示一个百分号前有一位的数字；</div><div class="line"><span class="string">",[a-zA-Z0-9]$"</span>：表示一个字符串以一个逗号后面跟着一个字母或数字结束。</div><div class="line"></div><div class="line">你也可以在方括号里用<span class="string">'^'</span>表示不希望出现的字符，<span class="string">'^'</span>应在方括号里的第一位。（如：<span class="string">"%[^a-zA-Z]%"</span>表</div><div class="line">示两个百分号中不应该出现字母）。</div><div class="line"></div><div class="line">为了逐字表达，你必须在<span class="string">"^.<span class="variable">$()</span>¦*+?&#123;\"这些字符前加上转移字符'\'。</span></div><div class="line">请注意在方括号中，不需要转义字符。</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">2.正则表达式验证控制文本框的输入字符类型</div><div class="line">1.只能输入数字和英文的：</div><div class="line">&lt;input onkeyup="value=value.replace(/[\W]/g,<span class="string">''</span>) <span class="string">" onbeforepaste="</span>clipboardData.setData(<span class="string">'text'</span>,clipboardData.getData(<span class="string">'text'</span>).replace(/[^\d]/g,<span class="string">''</span>))<span class="string">" ID="</span>Text1<span class="string">" NAME="</span>Text1<span class="string">"&gt;</span></div><div class="line"></div><div class="line">2.只能输入数字的：</div><div class="line">&lt;input onkeyup="value=value.replace(/[^\d]/g,<span class="string">''</span>) <span class="string">" onbeforepaste="</span>clipboardData.setData(<span class="string">'text'</span>,clipboardData.getData(<span class="string">'text'</span>).replace(/[^\d]/g,<span class="string">''</span>))<span class="string">" ID="</span>Text2<span class="string">" NAME="</span>Text2<span class="string">"&gt;</span></div><div class="line"></div><div class="line">3.只能输入全角的：</div><div class="line">&lt;input onkeyup="value=value.replace(/[^\uFF00-\uFFFF]/g,<span class="string">''</span>)<span class="string">" onbeforepaste="</span>clipboardData.setData(<span class="string">'text'</span>,clipboardData.getData(<span class="string">'text'</span>).replace(/[^\uFF00-\uFFFF]/g,<span class="string">''</span>))<span class="string">" ID="</span>Text3<span class="string">" NAME="</span>Text3<span class="string">"&gt;</span></div><div class="line"></div><div class="line">4.只能输入汉字的：</div><div class="line">&lt;input onkeyup="value=value.replace(/[^\u4E00-\u9FA5]/g,<span class="string">''</span>)<span class="string">" onbeforepaste="</span>clipboardData.setData(<span class="string">'text'</span>,clipboardData.getData(<span class="string">'text'</span>).replace(/[^\u4E00-\u9FA5]/g,<span class="string">''</span>))<span class="string">" ID="</span>Text4<span class="string">" NAME="</span>Text4<span class="string">"&gt;</span></div><div class="line"></div><div class="line"></div><div class="line">3.正则表达式的应用实例通俗说明</div><div class="line"></div><div class="line">*******************************************************************************</div><div class="line"></div><div class="line">//校验是否全由数字组成</div><div class="line"></div><div class="line">/^[0-9]&#123;1,20&#125;$/</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">^ 表示打头的字符要匹配紧跟^后面的规则</div><div class="line"></div><div class="line">$ 表示打头的字符要匹配紧靠$前面的规则</div><div class="line"></div><div class="line">[ ] 中的内容是可选字符集</div><div class="line"></div><div class="line">[0-9] 表示要求字符范围在0-9之间</div><div class="line"></div><div class="line">&#123;1,20&#125;表示数字字符串长度合法为1到20，即为[0-9]中的字符出现次数的范围是1到20次。</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">/^ 和 $/成对使用应该是表示要求整个字符串完全匹配定义的规则，而不是只匹配字符串中的一个子串。</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">*******************************************************************************</div><div class="line"></div><div class="line">//校验登录名：只能输入5-20个以字母开头、可带数字、“_”、“.”的字串</div><div class="line"></div><div class="line">/^[a-zA-Z]&#123;1&#125;([a-zA-Z0-9]|[._])&#123;4,19&#125;$/</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">^[a-zA-Z]&#123;1&#125; 表示第一个字符要求是字母。</div><div class="line"></div><div class="line">([a-zA-Z0-9]|[._])&#123;4,19&#125; 表示从第二位开始（因为它紧跟在上个表达式后面）的一个长度为4到9位的字符串，它要求是由大小写字母、数字或者特殊字符集[._]组成。</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">*******************************************************************************</div><div class="line"></div><div class="line">//校验用户姓名：只能输入1-30个以字母开头的字串</div><div class="line"></div><div class="line">/^[a-zA-Z]&#123;1,30&#125;$/</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">*******************************************************************************</div><div class="line"></div><div class="line">//校验密码：只能输入6-20个字母、数字、下划线</div><div class="line"></div><div class="line">/^(\w)&#123;6,20&#125;$/</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">\w：用于匹配字母，数字或下划线字符</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">*******************************************************************************</div><div class="line"></div><div class="line">//校验普通电话、传真号码：可以“+”或数字开头，可含有“-” 和 “ ”</div><div class="line"></div><div class="line">/^[+]&#123;0,1&#125;(\d)&#123;1,3&#125;[ ]?([-]?((\d)|[ ])&#123;1,12&#125;)+$/</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">\d：用于匹配从0到9的数字；</div><div class="line"></div><div class="line">“?”元字符规定其前导对象必须在目标对象中连续出现零次或一次</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">可以匹配的字符串如：+123 -999 999 ； +123-999 999 ；123 999 999 ；+123 999999等</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">*******************************************************************************</div><div class="line"></div><div class="line">//校验URL</div><div class="line"></div><div class="line">/^http[s]&#123;0,1&#125;:\/\/.+$/ 或 /^http[s]&#123;0,1&#125;:\/\/.&#123;1,n&#125;$/ (表示url串的长度为length(“https://”) + n )</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">\ / ：表示字符“/”。</div><div class="line"></div><div class="line">. 表示所有字符的集</div><div class="line"></div><div class="line">+ 等同于&#123;1,&#125;，就是1到正无穷吧。</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">*******************************************************************************</div><div class="line"></div><div class="line">//校验纯中文字符</div><div class="line"></div><div class="line">/^[\u4E00-\u9FA5]+$/</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">[\u4E00-\u9FA5] ：估计是中文字符集的范围吧</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">以上表达式均在下面的javascript中测试通过</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">&lt;html&gt;</div><div class="line"></div><div class="line">&lt;script language="JavaScript<span class="string">"&gt;</span></div><div class="line"></div><div class="line">&lt;!--</div><div class="line"></div><div class="line">function regx(r,s)</div><div class="line"></div><div class="line">&#123;</div><div class="line"></div><div class="line">       if (r == null || r == "<span class="string">")&#123;</span></div><div class="line"></div><div class="line">              return false;</div><div class="line"></div><div class="line">       &#125;</div><div class="line"></div><div class="line">       var patrn= new RegExp(r);</div><div class="line"></div><div class="line">       if (patrn.exec(s))</div><div class="line"></div><div class="line">              return true</div><div class="line"></div><div class="line">       return false</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">--&gt;</div><div class="line"></div><div class="line">&lt;/script&gt;</div><div class="line"></div><div class="line">&lt;body&gt;</div><div class="line"></div><div class="line">&lt;form&gt;</div><div class="line"></div><div class="line">       规则表达式 ： &lt;input type="input<span class="string">" name="</span>regxStr<span class="string">" value="</span><span class="string">" &gt; (填写/ /之间的表达式)</span></div><div class="line"></div><div class="line">&lt;br&gt;</div><div class="line"></div><div class="line">       校验字符串 ： &lt;input type="input<span class="string">" name="</span>str<span class="string">" value="</span><span class="string">" &gt;</span></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">       &lt;input type="button<span class="string">" name="</span>match<span class="string">" value="</span>匹配<span class="string">" onClick="</span>alert(regx(regxStr.value,str.value));<span class="string">"&gt;</span></div><div class="line"></div><div class="line">&lt;/form&gt;</div><div class="line"></div><div class="line">&lt;/body&gt;</div><div class="line"></div><div class="line">&lt;/html&gt;</div><div class="line"></div><div class="line">4.正則表達式應用</div><div class="line"></div><div class="line"></div><div class="line">"^\d+$<span class="string">"　　//非负整数（正整数 + 0）</span></div><div class="line">"^[0-9]*[1-9][0-9]*$<span class="string">"　　//正整数</span></div><div class="line">"^((-\d+)|(0+))$<span class="string">"　　//非正整数（负整数 + 0）</span></div><div class="line">"^-[0-9]*[1-9][0-9]*$<span class="string">"　　//负整数</span></div><div class="line">"^-?\d+$<span class="string">"　　　　//整数</span></div><div class="line">"^\d+(\.\d+)?$<span class="string">"　　//非负浮点数（正浮点数 + 0）</span></div><div class="line">"^(([0-9]+\.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*\.[0-9]+)|([0-9]*[1-9][0-9]*))$<span class="string">"　　//正浮点数</span></div><div class="line">"^((-\d+(\.\d+)?)|(0+(\.0+)?))$<span class="string">"　　//非正浮点数（负浮点数 + 0）</span></div><div class="line">"^(-(([0-9]+\.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*\.[0-9]+)|([0-9]*[1-9][0-9]*)))$<span class="string">"　　//负浮点数</span></div><div class="line">"^(-?\d+)(\.\d+)?$<span class="string">"　　//浮点数</span></div><div class="line">"^[A-Za-z]+$<span class="string">"　　//由26个英文字母组成的字符串</span></div><div class="line">"^[A-Z]+$<span class="string">"　　//由26个英文字母的大写组成的字符串</span></div><div class="line">"^[a-z]+$<span class="string">"　　//由26个英文字母的小写组成的字符串</span></div><div class="line">"^[A-Za-z0-9]+$<span class="string">"　　//由数字和26个英文字母组成的字符串</span></div><div class="line">"^\w+$<span class="string">"　　//由数字、26个英文字母或者下划线组成的字符串</span></div><div class="line">"^[\w-]+(\.[\w-]+)*@[\w-]+(\.[\w-]+)+$<span class="string">"　　　　//email地址</span></div><div class="line">"^[a-zA-z]+://(\w+(-\w+)*)(\.(\w+(-\w+)*))*(\?\S*)?$<span class="string">"　　//url</span></div><div class="line">/^(d&#123;2&#125;|d&#123;4&#125;)-((0([1-9]&#123;1&#125;))|(1[1|2]))-(([0-2]([1-9]&#123;1&#125;))|(3[0|1]))$/   //  年-月-日</div><div class="line">/^((0([1-9]&#123;1&#125;))|(1[1|2]))/(([0-2]([1-9]&#123;1&#125;))|(3[0|1]))/(d&#123;2&#125;|d&#123;4&#125;)$/   // 月/日/年</div><div class="line">"^([w-.]+)@(([[0-9]&#123;1,3&#125;.[0-9]&#123;1,3&#125;.[0-9]&#123;1,3&#125;.)|(([w-]+.)+))([a-zA-Z]&#123;2,4&#125;|[0-9]&#123;1,3&#125;)(]?)$<span class="string">"   //Emil</span></div><div class="line">"(d+-)?(d&#123;4&#125;-?d&#123;7&#125;|d&#123;3&#125;-?d&#123;8&#125;|^d&#123;7,8&#125;)(<span class="_">-d</span>+)?<span class="string">"     //电话号码</span></div><div class="line">"^(d&#123;1,2&#125;|1dd|2[0-4]d|25[0-5]).(d&#123;1,2&#125;|1dd|2[0-4]d|25[0-5]).(d&#123;1,2&#125;|1dd|2[0-4]d|25[0-5]).(d&#123;1,2&#125;|1dd|2[0-4]d|25[0-5])$<span class="string">"   //IP地址</span></div><div class="line"></div><div class="line">^([0-9A-F]&#123;2&#125;)(-[0-9A-F]&#123;2&#125;)&#123;5&#125;$   //MAC地址的正则表达式</div><div class="line">^[-+]?\d+(\.\d+)?$  //值类型正则表达式</div><div class="line"></div><div class="line"></div><div class="line">5.javascript正则表达式检验</div><div class="line">//校验是否全由数字组成</div><div class="line">function isDigit(s)</div><div class="line">&#123;</div><div class="line">var patrn=/^[0-9]&#123;1,20&#125;$/;</div><div class="line">if (!patrn.exec(s)) return false</div><div class="line">return true</div><div class="line">&#125;</div><div class="line"></div><div class="line">//校验登录名：只能输入5-20个以字母开头、可带数字、“_”、“.”的字串</div><div class="line">function isRegisterUserName(s)</div><div class="line">&#123;</div><div class="line">var patrn=/^[a-zA-Z]&#123;1&#125;([a-zA-Z0-9]|[._])&#123;4,19&#125;$/;</div><div class="line">if (!patrn.exec(s)) return false</div><div class="line">return true</div><div class="line">&#125;</div><div class="line"></div><div class="line">//校验用户姓名：只能输入1-30个以字母开头的字串</div><div class="line">function isTrueName(s)</div><div class="line">&#123;</div><div class="line">var patrn=/^[a-zA-Z]&#123;1,30&#125;$/;</div><div class="line">if (!patrn.exec(s)) return false</div><div class="line">return true</div><div class="line">&#125;</div><div class="line"></div><div class="line">//校验密码：只能输入6-20个字母、数字、下划线</div><div class="line">function isPasswd(s)</div><div class="line">&#123;</div><div class="line">var patrn=/^(\w)&#123;6,20&#125;$/;</div><div class="line">if (!patrn.exec(s)) return false</div><div class="line">return true</div><div class="line">&#125;</div><div class="line"></div><div class="line">//校验普通电话、传真号码：可以“+”开头，除数字外，可含有“-”</div><div class="line">function isTel(s)</div><div class="line">&#123;</div><div class="line">//var patrn=/^[+]&#123;0,1&#125;(\d)&#123;1,3&#125;[ ]?([-]?(\d)&#123;1,12&#125;)+$/;</div><div class="line">var patrn=/^[+]&#123;0,1&#125;(\d)&#123;1,3&#125;[ ]?([-]?((\d)|[ ])&#123;1,12&#125;)+$/;</div><div class="line">if (!patrn.exec(s)) return false</div><div class="line">return true</div><div class="line">&#125;</div><div class="line"></div><div class="line">//校验手机号码：必须以数字开头，除数字外，可含有“-”</div><div class="line">function isMobil(s)</div><div class="line">&#123;</div><div class="line">var patrn=/^[+]&#123;0,1&#125;(\d)&#123;1,3&#125;[ ]?([-]?((\d)|[ ])&#123;1,12&#125;)+$/;</div><div class="line">if (!patrn.exec(s)) return false</div><div class="line">return true</div><div class="line">&#125;</div><div class="line"></div><div class="line">//校验邮政编码</div><div class="line">function isPostalCode(s)</div><div class="line">&#123;</div><div class="line">//var patrn=/^[a-zA-Z0-9]&#123;3,12&#125;$/;</div><div class="line">var patrn=/^[a-zA-Z0-9 ]&#123;3,12&#125;$/;</div><div class="line">if (!patrn.exec(s)) return false</div><div class="line">return true</div><div class="line">&#125;</div><div class="line"></div><div class="line">//校验搜索关键字</div><div class="line">function isSearch(s)</div><div class="line">&#123;</div><div class="line">var patrn=/^[^`~!@#$%^&amp;*()+=|\\\][\]\&#123;\&#125;:;\'\,.&lt;&gt;/?]&#123;1&#125;[^`~!@$%^&amp;()+=|\\\][\]\&#123;\&#125;:;\'\,.&lt;&gt;?]&#123;0,19&#125;$/;</div><div class="line">if (!patrn.exec(s)) return false</div><div class="line">return true</div><div class="line">&#125;</div><div class="line"></div><div class="line">function isIP(s) //by zergling</div><div class="line">&#123;</div><div class="line">var patrn=/^[0-9.]&#123;1,20&#125;$/;</div><div class="line">if (!patrn.exec(s)) return false</div><div class="line">return true</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">/*********************************************************************************</div><div class="line">* FUNCTION: isBetween</div><div class="line">* PARAMETERS: val AS any value</div><div class="line">* lo AS Lower limit to check</div><div class="line">* hi AS Higher limit to check</div><div class="line">* CALLS: NOTHING</div><div class="line">* RETURNS: TRUE if val is between lo and hi both inclusive, otherwise false.</div><div class="line">**********************************************************************************/</div><div class="line">function isBetween (val, lo, hi) &#123;</div><div class="line">if ((val &lt; lo) || (val &gt; hi)) &#123; return(false); &#125;</div><div class="line">else &#123; return(true); &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">/*********************************************************************************</div><div class="line">* FUNCTION: isDate checks a valid date</div><div class="line">* PARAMETERS: theStr AS String</div><div class="line">* CALLS: isBetween, isInt</div><div class="line">* RETURNS: TRUE if theStr is a valid date otherwise false.</div><div class="line">**********************************************************************************/</div><div class="line">function isDate (theStr) &#123;</div><div class="line">var the1st = theStr.indexOf('-');</div><div class="line">var the2nd = theStr.lastIndexOf('-');</div><div class="line"></div><div class="line">if (the1st == the2nd) &#123; return(false); &#125;</div><div class="line">else &#123;</div><div class="line">var y = theStr.substring(0,the1st);</div><div class="line">var m = theStr.substring(the1st+1,the2nd);</div><div class="line">var d = theStr.substring(the2nd+1,theStr.length);</div><div class="line">var maxDays = 31;</div><div class="line"></div><div class="line">if (isInt(m)==false || isInt(d)==false || isInt(y)==false) &#123;</div><div class="line">return(false); &#125;</div><div class="line">else if (y.length &lt; 4) &#123; return(false); &#125;</div><div class="line">else if (!isBetween (m, 1, 12)) &#123; return(false); &#125;</div><div class="line">else if (m==4 || m==6 || m==9 || m==11) maxDays = 30;</div><div class="line">else if (m==2) &#123;</div><div class="line">if (y % 4 &gt; 0) maxDays = 28;</div><div class="line">else if (y % 100 == 0 &amp;&amp; y % 400 &gt; 0) maxDays = 28;</div><div class="line">else maxDays = 29;</div><div class="line">&#125;</div><div class="line">if (isBetween(d, 1, maxDays) == false) &#123; return(false); &#125;</div><div class="line">else &#123; return(true); &#125;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">/*********************************************************************************</div><div class="line">* FUNCTION: isEuDate checks a valid date in British format</div><div class="line">* PARAMETERS: theStr AS String</div><div class="line">* CALLS: isBetween, isInt</div><div class="line">* RETURNS: TRUE if theStr is a valid date otherwise false.</div><div class="line">**********************************************************************************/</div><div class="line">function isEuDate (theStr) &#123;</div><div class="line">if (isBetween(theStr.length, 8, 10) == false) &#123; return(false); &#125;</div><div class="line">else &#123;</div><div class="line">var the1st = theStr.indexOf('/');</div><div class="line">var the2nd = theStr.lastIndexOf('/');</div><div class="line"></div><div class="line">if (the1st == the2nd) &#123; return(false); &#125;</div><div class="line">else &#123;</div><div class="line">var m = theStr.substring(the1st+1,the2nd);</div><div class="line">var d = theStr.substring(0,the1st);</div><div class="line">var y = theStr.substring(the2nd+1,theStr.length);</div><div class="line">var maxDays = 31;</div><div class="line"></div><div class="line">if (isInt(m)==false || isInt(d)==false || isInt(y)==false) &#123;</div><div class="line">return(false); &#125;</div><div class="line">else if (y.length &lt; 4) &#123; return(false); &#125;</div><div class="line">else if (isBetween (m, 1, 12) == false) &#123; return(false); &#125;</div><div class="line">else if (m==4 || m==6 || m==9 || m==11) maxDays = 30;</div><div class="line">else if (m==2) &#123;</div><div class="line">if (y % 4 &gt; 0) maxDays = 28;</div><div class="line">else if (y % 100 == 0 &amp;&amp; y % 400 &gt; 0) maxDays = 28;</div><div class="line">else maxDays = 29;</div><div class="line">&#125;</div><div class="line"></div><div class="line">if (isBetween(d, 1, maxDays) == false) &#123; return(false); &#125;</div><div class="line">else &#123; return(true); &#125;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line">/********************************************************************************</div><div class="line">* FUNCTION: Compare Date! Which is the latest!</div><div class="line">* PARAMETERS: lessDate,moreDate AS String</div><div class="line">* CALLS: isDate,isBetween</div><div class="line">* RETURNS: TRUE if lessDate&lt;moreDate</div><div class="line">*********************************************************************************/</div><div class="line">function isComdate (lessDate , moreDate)</div><div class="line">&#123;</div><div class="line">if (!isDate(lessDate)) &#123; return(false);&#125;</div><div class="line">if (!isDate(moreDate)) &#123; return(false);&#125;</div><div class="line">var less1st = lessDate.indexOf('-');</div><div class="line">var less2nd = lessDate.lastIndexOf('-');</div><div class="line">var more1st = moreDate.indexOf('-');</div><div class="line">var more2nd = moreDate.lastIndexOf('-');</div><div class="line">var lessy = lessDate.substring(0,less1st);</div><div class="line">var lessm = lessDate.substring(less1st+1,less2nd);</div><div class="line">var lessd = lessDate.substring(less2nd+1,lessDate.length);</div><div class="line">var morey = moreDate.substring(0,more1st);</div><div class="line">var morem = moreDate.substring(more1st+1,more2nd);</div><div class="line">var mored = moreDate.substring(more2nd+1,moreDate.length);</div><div class="line">var Date1 = new Date(lessy,lessm,lessd);</div><div class="line">var Date2 = new Date(morey,morem,mored);</div><div class="line">if (Date1&gt;Date2) &#123; return(false);&#125;</div><div class="line">return(true);</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">/*********************************************************************************</div><div class="line">* FUNCTION isEmpty checks if the parameter is empty or null</div><div class="line">* PARAMETER str AS String</div><div class="line">**********************************************************************************/</div><div class="line">function isEmpty (str) &#123;</div><div class="line">if ((str==null)||(str.length==0)) return true;</div><div class="line">else return(false);</div><div class="line">&#125;</div><div class="line"></div><div class="line">/*********************************************************************************</div><div class="line">* FUNCTION: isInt</div><div class="line">* PARAMETER: theStr AS String</div><div class="line">* RETURNS: TRUE if the passed parameter is an integer, otherwise FALSE</div><div class="line">* CALLS: isDigit</div><div class="line">**********************************************************************************/</div><div class="line">function isInt (theStr) &#123;</div><div class="line">var flag = true;</div><div class="line"></div><div class="line">if (isEmpty(theStr)) &#123; flag=false; &#125;</div><div class="line">else</div><div class="line">&#123; for (var i=0; i&lt;theStr.length; i++) &#123;</div><div class="line">if (isDigit(theStr.substring(i,i+1)) == false) &#123;</div><div class="line">flag = false; break;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">return(flag);</div><div class="line">&#125;</div><div class="line"></div><div class="line">/*********************************************************************************</div><div class="line">* FUNCTION: isReal</div><div class="line">* PARAMETER: heStr AS String</div><div class="line">decLen AS Integer (how many digits after period)</div><div class="line">* RETURNS: TRUE if theStr is a float, otherwise FALSE</div><div class="line">* CALLS: isInt</div><div class="line">**********************************************************************************/</div><div class="line">function isReal (theStr, decLen) &#123;</div><div class="line">var dot1st = theStr.indexOf('.');</div><div class="line">var dot2nd = theStr.lastIndexOf('.');</div><div class="line">var OK = true;</div><div class="line"></div><div class="line">if (isEmpty(theStr)) return false;</div><div class="line"></div><div class="line">if (dot1st == -1) &#123;</div><div class="line">if (!isInt(theStr)) return(false);</div><div class="line">else return(true);</div><div class="line">&#125;</div><div class="line"></div><div class="line">else if (dot1st != dot2nd) return (false);</div><div class="line">else if (dot1st==0) return (false);</div><div class="line">else &#123;</div><div class="line">var intPart = theStr.substring(0, dot1st);</div><div class="line">var decPart = theStr.substring(dot2nd+1);</div><div class="line"></div><div class="line">if (decPart.length &gt; decLen) return(false);</div><div class="line">else if (!isInt(intPart) || !isInt(decPart)) return (false);</div><div class="line">else if (isEmpty(decPart)) return (false);</div><div class="line">else return(true);</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">/*********************************************************************************</div><div class="line">* FUNCTION: isEmail</div><div class="line">* PARAMETER: String (Email Address)</div><div class="line">* RETURNS: TRUE if the String is a valid Email address</div><div class="line">* FALSE if the passed string is not a valid Email Address</div><div class="line">* EMAIL FORMAT: AnyName@EmailServer e.g; webmaster@hotmail.com</div><div class="line">* @ sign can appear only once in the email address.</div><div class="line">*********************************************************************************/</div><div class="line">function isEmail (theStr) &#123;</div><div class="line">var atIndex = theStr.indexOf('@');</div><div class="line">var dotIndex = theStr.indexOf('.', atIndex);</div><div class="line">var flag = true;</div><div class="line">theSub = theStr.substring(0, dotIndex+1)</div><div class="line"></div><div class="line">if ((atIndex &lt; 1)||(atIndex != theStr.lastIndexOf('@'))||(dotIndex &lt; atIndex + 2)||(theStr.length &lt;= theSub.length))</div><div class="line">&#123; return(false); &#125;</div><div class="line">else &#123; return(true); &#125;</div><div class="line">&#125;</div><div class="line">/*********************************************************************************</div><div class="line">* FUNCTION: newWindow</div><div class="line">* PARAMETERS: doc -&gt; Document to open in the new window</div><div class="line">hite -&gt; Height of the new window</div><div class="line">wide -&gt; Width of the new window</div><div class="line">bars -&gt; 1-Scroll bars = YES 0-Scroll Bars = NO</div><div class="line">resize -&gt; 1-Resizable = YES 0-Resizable = NO</div><div class="line">* CALLS: NONE</div><div class="line">* RETURNS: New window instance</div><div class="line">**********************************************************************************/</div><div class="line">function newWindow (doc, hite, wide, bars, resize) &#123;</div><div class="line">var winNew="_blank<span class="string">";</span></div><div class="line">var opt="toolbar=0,location=0,directories=0,status=0,menubar=0,<span class="string">";</span></div><div class="line">opt+=("scrollbars=<span class="string">"+bars+"</span>,<span class="string">");</span></div><div class="line">opt+=("resizable=<span class="string">"+resize+"</span>,<span class="string">");</span></div><div class="line">opt+=("width=<span class="string">"+wide+"</span>,<span class="string">");</span></div><div class="line">opt+=("height=<span class="string">"+hite);</span></div><div class="line">winHandle=window.open(doc,winNew,opt);</div><div class="line">return;</div><div class="line">&#125;</div><div class="line">/*********************************************************************************</div><div class="line">* FUNCTION: DecimalFormat</div><div class="line">* PARAMETERS: paramValue -&gt; Field value</div><div class="line">* CALLS: NONE</div><div class="line">* RETURNS: Formated string</div><div class="line">**********************************************************************************/</div><div class="line">function DecimalFormat (paramValue) &#123;</div><div class="line">var intPart = parseInt(paramValue);</div><div class="line">var decPart =parseFloat(paramValue) - intPart;</div><div class="line"></div><div class="line">str = "<span class="string">";</span></div><div class="line">if ((decPart == 0) || (decPart == null)) str += (intPart + ".00<span class="string">");</span></div><div class="line">else str += (intPart + decPart);</div><div class="line"></div><div class="line">return (str);</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">"^\\d+$<span class="string">"　　//非负整数（正整数 + 0）</span></div><div class="line">"^[0-9]*[1-9][0-9]*$<span class="string">"　　//正整数</span></div><div class="line">"^((-\\d+)|(0+))$<span class="string">"　　//非正整数（负整数 + 0）</span></div><div class="line">"^-[0-9]*[1-9][0-9]*$<span class="string">"　　//负整数</span></div><div class="line">"^-?\\d+$<span class="string">"　　　　//整数</span></div><div class="line">"^\\d+(\\.\\d+)?$<span class="string">"　　//非负浮点数（正浮点数 + 0）</span></div><div class="line">"^(([0-9]+\\.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*\\.[0-9]+)|([0-9]*[1-9][0-9]*))$<span class="string">"　　//正浮点数</span></div><div class="line">"^((-\\d+(\\.\\d+)?)|(0+(\\.0+)?))$<span class="string">"　　//非正浮点数（负浮点数 + 0）</span></div><div class="line">"^(-(([0-9]+\\.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*\\.[0-9]+)|([0-9]*[1-9][0-9]*)))$<span class="string">"　　//负浮点数</span></div><div class="line">"^(-?\\d+)(\\.\\d+)?$<span class="string">"　　//浮点数</span></div><div class="line">"^[A-Za-z]+$<span class="string">"　　//由26个英文字母组成的字符串</span></div><div class="line">"^[A-Z]+$<span class="string">"　　//由26个英文字母的大写组成的字符串</span></div><div class="line">"^[a-z]+$<span class="string">"　　//由26个英文字母的小写组成的字符串</span></div><div class="line">"^[A-Za-z0-9]+$<span class="string">"　　//由数字和26个英文字母组成的字符串</span></div><div class="line">"^\\w+$<span class="string">"　　//由数字、26个英文字母或者下划线组成的字符串</span></div><div class="line">"^[\\w-]+(\\.[\\w-]+)*@[\\w-]+(\\.[\\w-]+)+$<span class="string">"　　　　//email地址</span></div><div class="line">"^[a-zA-z]+://(\\w+(-\\w+)*)(\\.(\\w+(-\\w+)*))*(\\?\\S*)?$<span class="string">"　　//url</span></div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/07/js-close-bag/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Mr.Hua">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Mr.Hua's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Mr.Hua's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/07/js-close-bag/" itemprop="url">
                  Javascript函数、递归与闭包
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Veröffentlicht am</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-07T21:21:02+08:00">
                2016-12-07
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="函数表达式"><a href="#函数表达式" class="headerlink" title="函数表达式"></a>函数表达式</h2><p>JavaScript中定义函数有2钟方法：</p>
<p>##函数声明：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">funcName</span>(<span class="params">arg1,arg2,arg3</span>)</span>&#123;</div><div class="line">  <span class="comment">//函数体</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<pre><code>①name属性：可读取函数名。非标准，浏览器支持:FF、Chrome、safari、Opera。
②函数声明提升：指执行代码之前会先读取函数声明。即函数调用可置于函数声明之前。
</code></pre><p>##函数表达式：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> funcName = <span class="function"><span class="keyword">function</span>(<span class="params">arg1,arg2,arg3</span>)</span>&#123;</div><div class="line">  <span class="comment">//函数体</span></div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>　　　　 ①匿名函数(anonymous function，或拉姆达函数)：function关键字后无标识符，name属性值为空字符串。在把函数当成值使用时，都可用匿名函数。<br>　　　　 ②类似其他表达式，函数表达式使用前需先赋值，故不存在”函数声明提升”那样的作用。<br>　　　　 ③ECMAScript中的无效函数语法：</p>
<p>if判断中的重复函数声明<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span>(condition)&#123;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">sayHi</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        alert(<span class="string">"Hi!"</span>);</div><div class="line">    &#125;</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">sayHi</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        alert(<span class="string">"Yo!"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　　　　　浏览器JavaScript引擎修正错误差异：大多浏览器会返回第二个声明，忽略condition；FF则会在condition为true时返回第一个声明。<br>　　　　　　使用函数表达式可解决并实现：</p>
<p>if判断 函数表达式<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> sayHi;</div><div class="line"><span class="keyword">if</span>(condition)&#123;</div><div class="line">    sayHi = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        alert(<span class="string">"Hi!"</span>);</div><div class="line">    &#125;</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">    sayHi = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        alert(<span class="string">"Yo!"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="递归"><a href="#递归" class="headerlink" title="递归"></a>递归</h2><p>　　递归函数，是在一个函数中通过名字调用自身的情况下构成的。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">factorial</span>(<span class="params">num</span>)</span>&#123;   <span class="comment">//一个经典的递归阶乘函数</span></div><div class="line">    <span class="keyword">if</span> (num &lt;= <span class="number">1</span>)&#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">return</span> num * factorial(num<span class="number">-1</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p> 　　　　①若使用下列代码调用该函数，会出错：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> anotherFactorial = factorial;</div><div class="line">factorial = <span class="literal">null</span>;</div><div class="line">alert(anotherFactorial(<span class="number">4</span>));</div></pre></td></tr></table></figure></p>
<p>　　　将factorial()函数保存到变量anotherFactorial中后，将factorial变量设为null后不再引用函数，而anotherFactorial(4)中要执行factorial()函数，故出错。<br>　　　使用argument.callee(指向正在执行的函数的指针)可解决：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//解决方案</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">factorial</span>(<span class="params">num</span>)</span>&#123;</div><div class="line">    <span class="keyword">if</span> (num &lt;= <span class="number">1</span>)&#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">return</span> num * <span class="built_in">arguments</span>.callee(num<span class="number">-1</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> anotherFactorial = factorial;</div><div class="line">factorial = <span class="literal">null</span>;</div><div class="line">alert(anotherFactorial(<span class="number">4</span>));  <span class="comment">//24</span></div></pre></td></tr></table></figure>
<p>　　　　在非严格模式，使用递归函数时，用argument.callee代替函数名更保险<br>　　　　在严格模式下，使用argument.callee会出错，可用函数表达式 代替 函数声明：</p>
<p>函数表达式代替函数声明<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> factorial = <span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">num</span>)</span>&#123;</div><div class="line">    <span class="keyword">if</span> (num &lt;= <span class="number">1</span>)&#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">return</span> num * f(num<span class="number">-1</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h2><p>　　指有权访问另一个函数作用域中的变量的函数。(常见形式为函数嵌套)<br>复制代码代码如下:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">wai</span>(<span class="params">pro</span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">obj1,obj2</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> val1 = obj1[pro];</div><div class="line">        <span class="keyword">var</span> val2 = obj2[pro];</div><div class="line">        <span class="keyword">if</span>(val1&lt;val2)&#123;</div><div class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(val1&gt;val2)&#123;</div><div class="line">            <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">        &#125;<span class="keyword">else</span>&#123;</div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">        &#125;;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　　　return匿名函数时，匿名函数的作用域链初始化为包含函数的活动对象和全局变量对象。即匿名函数包含wai()函数的作用域。<br>　　每个函数被调用时，会创建一个执行环境、一个变量对象 及 相应的作用域链。</p>
<p>##执行环境 及 作用域<br>　　执行环境execution context简称环境，定义了变量和函数有权访问的其他数据，并决定他们的各自行为。<br>　　①每个执行环境都有一个变量对象variable object，保存环境定义的所有变量和函数。该对象无法编码访问，但解析器在处理数据时会在后台使用它。<br>　　  全局变量对象是最外围的一个执行环境。在Web浏览器中被认为是window对象，故所有全局对象和函数都是window对象的属性和方法创建的。<br>　　  执行环境中的代码执行完后，该环境就被销毁，保存其中的变量和函数定义也随之销毁。<br>　　②代码在环境中执行时，会创建变量对象的一个作用域链scope chain，用于保证对执行环境有权访问的所有变量和函数的有序访问。<br>　　  作用域链前端，始终是当前执行的代码所在环境的变量对象。当该环境为函数时，会将活动对象作为变量对象。<br>　　  活动对象最开始只包含一个变量，即argumnt对象。<br>　　  作用域链中的下一个变量对象来自包含环境，而下一个变量对象来自下一个包含环境，直至延续到全局执行环境。<br>　　③标识符解析：从前段开始，沿着作用域链一级一级地搜索标识符的过程。【找不到通常会导致错误发生】</p>
<p>##函数创建、执行时：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">compare</span>(<span class="params">val1,val2</span>)</span>&#123;</div><div class="line">     <span class="keyword">if</span>(val1&lt;val2)&#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(val1&gt;val2)&#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;;</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> result = compare(<span class="number">5</span> , <span class="number">10</span>);</div></pre></td></tr></table></figure></p>
<p>　　①创建函数compare()时，会创建一个预先包含全局变量对象的作用域链，并保存在内部[[scope]]属性中。<br>　　②局部函数compare()的变量对象，只在函数执行的过程中存在。<br>　　　当调函数时，会创建一个执行环境，再通过复制函数的[[scope]]属性中的对象 构建起执行环境的作用域链。<br>　　③第一次调用函数时，如compare()，会创建一个包含this、argument、val1 和 val2的活动对象。<br>　　④全局执行环境的变量对象(包括this、result、compare)在compare()执行环境的作用域链中处于第二位。<br>　　⑤作用域链 本质是一个指向变量对象的指针列表，只引用但不实际包含变量对象。<br>　　⑥无论什么时候在函数中访问一个变量，都会行作用域链中搜索具有相应名字的变量。</p>
<p>##闭包的作用域链<br>　　在另外一个函数内部定义的函数会将包含函数的活动对象添加到它的作用域链中。<br>　　①将函数对象赋值null，等于通知垃圾回收例程将其清除，随着函数作用域链被销毁，其作用域链(不除了全局作用域)也会被安全销毁。<br>　　②由于闭包会携带包含函数的作用域，所以会比其他函数占用更多内存。</p>
<p>##闭包与变量<br>　　作用域链的一个副作用：闭包只能取得包含函数中任何变量的最后一个值。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">createFunctions</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> result = <span class="keyword">new</span> <span class="built_in">Array</span>();</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i &lt; <span class="number">10</span>; i++)&#123;</div><div class="line">        result[i] = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">            <span class="keyword">return</span> i;</div><div class="line">        &#125;;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> result;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　①createFunctions()函数，将10个闭包赋值给数组result，再返回result数组。每个闭包都返回自己的索引，但实际上都返回10。<br>　　　因为每个函数(闭包)的作用域链中都保存着createFunctions()函数的活动对象，所以它们引用的是同一个变量i，当createFunctions函数执行完后i的值10，故闭包中的i也都为10。<br>　　②解决办法，不使用闭包，创建一个匿名函数，将i值赋值给其参数：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">createFunctions</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> result = <span class="keyword">new</span> <span class="built_in">Array</span>();</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i &lt; <span class="number">10</span>; i++)&#123;</div><div class="line">        result[i] = <span class="function"><span class="keyword">function</span>(<span class="params">num</span>)</span>&#123;</div><div class="line">            <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">                <span class="keyword">return</span> num;</div><div class="line">            &#125;;</div><div class="line">        &#125;(i);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> result;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　创建一个每次循环都会执行一次的匿名函数：将每次循环时包围函数的i值作为参数，存入匿名函数中。因为函数参数是按值传递的，而非引用，所以每个匿名函数中的num值 都为每此循环时i值的一个副本。</p>
<p>##this对象<br>　　this对象是在运行时基于函数的执行环境绑定的。<br>　　　　在全局函数中，this等于window；当函数被某对象调用时，this为该对象。<br>　　　　匿名函数的执行环境有全局性，其this对象通常指window。通过call()或spply()改变函数执行环境时，this指向其对象。<br>　　①每个函数在被调用时，都会自动取得两个特殊变量：this和argument。内部函数在搜索这两个变量时，只会搜索到期活动对象为止，永远不可能访问外部函数的这两个变量。<br>　　　　不过将外部作用域的this对象保存在一个闭包能访问的变量里，就可让闭包访问该对象。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">闭包 访问外部函数的<span class="keyword">this</span>对象</div><div class="line"><span class="keyword">var</span> name = <span class="string">"The Window"</span>;</div><div class="line"><span class="keyword">var</span> object = &#123;</div><div class="line">    <span class="attr">name</span> : <span class="string">"My Object"</span>,</div><div class="line">    <span class="attr">getNameFunc</span> : <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> that = <span class="keyword">this</span>;</div><div class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">            <span class="keyword">return</span> that.name;</div><div class="line">        &#125;;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line">alert(object.getNameFunc()());  <span class="comment">//"MyObject"</span></div></pre></td></tr></table></figure></p>
<p>　　　包围函数的argument对象 也可通过此方法被闭包访问。<br>5、函数声明 转换为 函数表达式<br>　　JavaScript将function关键字昨晚函数声明的开始，但函数声明后面不能跟圆括号，所以function(){……}();会出错。<br>　　要将函数声明转换为函数表达式，需为函数声明加一对圆括号：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">   <span class="comment">//块级作用域</span></div><div class="line">&#125;)();</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/07/js-call-apply/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Mr.Hua">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Mr.Hua's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Mr.Hua's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/07/js-call-apply/" itemprop="url">
                  JS中的 call和apply的区别和作用
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Veröffentlicht am</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-07T17:38:18+08:00">
                2016-12-07
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Javascript的每个Function对象中有一个apply方法：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span>.<span class="title">apply</span>(<span class="params">[thisObj[,argArray]]</span>)</span></div></pre></td></tr></table></figure></p>
<p>还有一个类似功能的call方法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span>.<span class="title">call</span>(<span class="params">[thisObj[,arg1[, arg2[, [,.argN]]]]]</span>)</span></div></pre></td></tr></table></figure>
<p>它们各自的定义：</p>
<p>apply：应用某一对象的一个方法，用另一个对象替换当前对象。</p>
<p>call：调用一个对象的一个方法，以另一个对象替换当前对象。</p>
<p>它们的共同之处：</p>
<p>都“可以用来代替另一个对象调用一个方法，将一个函数的对象上下文从初始的上下文改变为由 thisObj 指定的新对象。”</p>
<p>它们的不同之处：</p>
<p>apply：</p>
<p>最多只能有两个参数——新this对象和一个数组 argArray。如果给该方法传递多个参数，则把参数都写进这个数组里面，当然，即使只有一个参数，也要写进数组里面。如果 argArray 不是一个有效的数组或者不是 arguments 对象，那么将导致一个 TypeError。如果没有提供 argArray 和 thisObj 任何一个参数，那么 Global 对象将被用作 thisObj，并且无法被传递任何参数。</p>
<p>call：</p>
<p>则是直接的参数列表，主要用在js对象各方法互相调用的时候，使当前this实例指针保持一致,或在特殊情况下需要改变this指针。如果没有提供 thisObj 参数，那么 Global 对象被用作 thisObj。</p>
<p>更简单地说，apply和call功能一样，只是传入的参数列表形式不同：如 func.call(func1,var1,var2,var3)   对应的apply写法为：func.apply(func1,[var1,var2,var3])</p>
<p>也就是说：call调用的为单个，apply调用的参数为数组</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">a,b</span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span> === <span class="built_in">window</span>);<span class="comment">//true</span></div><div class="line">    <span class="built_in">console</span>.log(a + b);</div><div class="line"> &#125;</div><div class="line"> sum(<span class="number">1</span>,<span class="number">2</span>);</div><div class="line"> sum.call(<span class="literal">null</span>,<span class="number">1</span>,<span class="number">2</span>);</div><div class="line"> sum.apply(<span class="literal">null</span>,[<span class="number">1</span>,<span class="number">2</span>]);</div></pre></td></tr></table></figure>
<p>作用　　</p>
<h2 id="调用函数"><a href="#调用函数" class="headerlink" title="调用函数"></a>调用函数</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> info = <span class="string">'tom'</span>;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="comment">//this指向window</span></div><div class="line">    <span class="keyword">var</span> info = <span class="string">'jerry'</span>;</div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.info);  <span class="comment">//tom</span></div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>===<span class="built_in">window</span>)   <span class="comment">//true</span></div><div class="line">&#125;</div><div class="line">foo();</div><div class="line">foo.call();</div><div class="line">foo.apply();</div></pre></td></tr></table></figure>
<h2 id="call和apply可以改变函数中this的指向"><a href="#call和apply可以改变函数中this的指向" class="headerlink" title="call和apply可以改变函数中this的指向　　"></a>call和apply可以改变函数中this的指向　　</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> obj = &#123;</div><div class="line">        <span class="attr">info</span>:<span class="string">'spike'</span></div><div class="line">&#125;;</div><div class="line">foo.call(obj);    <span class="comment">//这里foo函数里面的this就指向了obj</span></div><div class="line">foo.apply(obj);</div></pre></td></tr></table></figure>
<p>c、借用别的对象的方法<br>求数组中的最大值</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> arr = [<span class="number">123</span>,<span class="number">34</span>,<span class="number">5</span>,<span class="number">23</span>,<span class="number">3434</span>,<span class="number">23</span>];</div><div class="line"><span class="comment">//方法一</span></div><div class="line"><span class="keyword">var</span> arr1 = arr.sort(<span class="function"><span class="keyword">function</span>(<span class="params">a,b</span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> b-a;</div><div class="line">&#125;);</div><div class="line"><span class="built_in">console</span>.log(arr1[<span class="number">0</span>]);</div><div class="line"><span class="comment">//方法二</span></div><div class="line"><span class="keyword">var</span> max = <span class="built_in">Math</span>.max.apply(<span class="literal">null</span>,arr)   <span class="comment">//借用别的对象的方法</span></div><div class="line"><span class="built_in">console</span>.log(max);</div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/07/js-arguments/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Mr.Hua">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Mr.Hua's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Mr.Hua's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/07/js-arguments/" itemprop="url">
                  js使用 arguments 参数实现函数重载
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Veröffentlicht am</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-07T17:27:13+08:00">
                2016-12-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">in</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/es6/" itemprop="url" rel="index">
                    <span itemprop="name">es6</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="arguments"><a href="#arguments" class="headerlink" title="arguments"></a>arguments</h2><p>js进行函数调用时，除了指定的参数外，还创建一个隐含的对象——arguments。</p>
<p>arguments可以用arguments[index]这样的语法取值，拥有长度属性length。arguments对<br>象存储的是实际传递给函数的参数，而不局限于函数声明所定义的参数列表，例如：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">func</span>(<span class="params">a,b</span>)</span>&#123;</div><div class="line">　　alert(a);</div><div class="line">　　alert(b);</div><div class="line">　　<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="built_in">arguments</span>.length;i++)&#123;</div><div class="line">    alert(<span class="built_in">arguments</span>[i]);</div><div class="line">　　&#125;</div><div class="line">&#125;</div><div class="line">　func(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>);</div></pre></td></tr></table></figure></p>
<p>代码运行时会依次显示：1，2，1，2，3，4。函数定义了两个参数，但是在调用的时候传递了4个参数。</p>
<h2 id="arguments的callee属性"><a href="#arguments的callee属性" class="headerlink" title="arguments的callee属性"></a>arguments的callee属性</h2><p>它表示对函数对象本身的引用，这有利于实现无名函数的递归或者保证函数的封装性。例如：用递归来计算1到n的自然数之和：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> sum=<span class="function"><span class="keyword">function</span>(<span class="params">n</span>)</span>&#123;</div><div class="line">　   <span class="keyword">if</span>(<span class="number">1</span>==n) &#123;</div><div class="line">    <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">　   &#125; <span class="keyword">else</span> &#123;</div><div class="line">    <span class="keyword">return</span> n + <span class="built_in">arguments</span>.callee(n<span class="number">-1</span>);</div><div class="line">  &#125;</div><div class="line">　 &#125;</div><div class="line">　 alert(sum(<span class="number">100</span>));</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/07/how-to-write-module-js/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Mr.Hua">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Mr.Hua's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Mr.Hua's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/07/how-to-write-module-js/" itemprop="url">
                  js模块化的几种写法
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Veröffentlicht am</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-07T17:23:15+08:00">
                2016-12-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">in</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/es6/" itemprop="url" rel="index">
                    <span itemprop="name">es6</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原始写法"><a href="#原始写法" class="headerlink" title="原始写法"></a>原始写法</h2><p>模块就是实现特定功能的一组方法。<br>只要把不同的函数（以及记录状态的变量）简单地放在一起，就算是一个模块。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">　　<span class="function"><span class="keyword">function</span> <span class="title">m1</span>(<span class="params"></span>)</span>&#123;</div><div class="line">　　　　<span class="comment">//...</span></div><div class="line">　　&#125;</div><div class="line">　　<span class="function"><span class="keyword">function</span> <span class="title">m2</span>(<span class="params"></span>)</span>&#123;</div><div class="line">　　　　<span class="comment">//...</span></div><div class="line">　　&#125;</div></pre></td></tr></table></figure></p>
<p>上面的函数m1()和m2()，组成一个模块。使用的时候，直接调用就行了。<br>这种做法的缺点很明显：”污染”了全局变量，无法保证不与其他模块发生变量名冲突，而且模块成员之间看不出直接关系。</p>
<h2 id="对象写法"><a href="#对象写法" class="headerlink" title="对象写法"></a>对象写法</h2><p>为了解决上面的缺点，可以把模块写成一个对象，所有的模块成员都放到这个对象里面。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">　　<span class="keyword">var</span> module1 = <span class="keyword">new</span> <span class="built_in">Object</span>(&#123;</div><div class="line">　　　　<span class="attr">_count</span> : <span class="number">0</span>,</div><div class="line">　　　　<span class="attr">m1</span> : <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</div><div class="line">　　　　　　<span class="comment">//...</span></div><div class="line">　　　　&#125;,</div><div class="line">　　　　<span class="attr">m2</span> : <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</div><div class="line">　　　　　　<span class="comment">//...</span></div><div class="line">　　　　&#125;</div><div class="line">　　&#125;);</div></pre></td></tr></table></figure></p>
<p>上面的函数m1()和m2(），都封装在module1对象里。使用的时候，就是调用这个对象的属性。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">　　module1.m1();</div></pre></td></tr></table></figure></p>
<p>但是，这样的写法会暴露所有模块成员，内部状态可以被外部改写。比如，外部代码可以直接改变内部计数器的值。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">　　module1._count = <span class="number">5</span>;</div></pre></td></tr></table></figure></p>
<h2 id="立即执行函数写法"><a href="#立即执行函数写法" class="headerlink" title="立即执行函数写法"></a>立即执行函数写法</h2><p>使用”立即执行函数”（Immediately-Invoked Function Expression，IIFE），可以达到不暴露私有成员的目的。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">　　<span class="keyword">var</span> module1 = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">　　　　<span class="keyword">var</span> _count = <span class="number">0</span>;</div><div class="line">　　　　<span class="keyword">var</span> m1 = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">　　　　　　<span class="comment">//...</span></div><div class="line">　　　　&#125;;</div><div class="line">　　　　<span class="keyword">var</span> m2 = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">　　　　　　<span class="comment">//...</span></div><div class="line">　　　　&#125;;</div><div class="line">　　　　<span class="keyword">return</span> &#123;</div><div class="line">　　　　　　<span class="attr">m1</span> : m1,</div><div class="line">　　　　　　<span class="attr">m2</span> : m2</div><div class="line">　　　　&#125;;</div><div class="line">　　&#125;)();</div></pre></td></tr></table></figure></p>
<p>使用上面的写法，外部代码无法读取内部的_count变量。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">　　<span class="built_in">console</span>.info(module1._count); <span class="comment">//undefined</span></div></pre></td></tr></table></figure></p>
<p>module1就是Javascript模块的基本写法。下面，再对这种写法进行加工。</p>
<h2 id="放大模式"><a href="#放大模式" class="headerlink" title="放大模式"></a>放大模式</h2><p>如果一个模块很大，必须分成几个部分，或者一个模块需要继承另一个模块，这时就有必要采用”放大模式”（augmentation）。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">　　<span class="keyword">var</span> module1 = (<span class="function"><span class="keyword">function</span> (<span class="params">mod</span>)</span>&#123;</div><div class="line">　　　　mod.m3 = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">　　　　　　<span class="comment">//...</span></div><div class="line">　　　　&#125;;</div><div class="line">　　　　<span class="keyword">return</span> mod;</div><div class="line">　　&#125;)(module1);</div></pre></td></tr></table></figure></p>
<p>上面的代码为module1模块添加了一个新方法m3()，然后返回新的module1模块。</p>
<h2 id="宽放大模式（Loose-augmentation）"><a href="#宽放大模式（Loose-augmentation）" class="headerlink" title="宽放大模式（Loose augmentation）"></a>宽放大模式（Loose augmentation）</h2><p>在浏览器环境中，模块的各个部分通常都是从网上获取的，有时无法知道哪个部分会先加载。如果采用上一节的写法，第一个执行的部分有可能加载一个不存在空对象，这时就要采用”宽放大模式”。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">　　<span class="keyword">var</span> module1 = ( <span class="function"><span class="keyword">function</span> (<span class="params">mod</span>)</span>&#123;</div><div class="line">　　　　<span class="comment">//...</span></div><div class="line">　　　　<span class="keyword">return</span> mod;</div><div class="line">　　&#125;)(<span class="built_in">window</span>.module1 || &#123;&#125;);</div></pre></td></tr></table></figure></p>
<p>与”放大模式”相比，＂宽放大模式＂就是”立即执行函数”的参数可以是空对象。</p>
<h2 id="输入全局变量"><a href="#输入全局变量" class="headerlink" title="输入全局变量"></a>输入全局变量</h2><p>独立性是模块的重要特点，模块内部最好不与程序的其他部分直接交互。<br>为了在模块内部调用全局变量，必须显式地将其他变量输入模块。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">　　<span class="keyword">var</span> module1 = (<span class="function"><span class="keyword">function</span> (<span class="params">$, YAHOO</span>) </span>&#123;</div><div class="line">　　　　<span class="comment">//...</span></div><div class="line">　　&#125;)(jQuery, YAHOO);</div></pre></td></tr></table></figure></p>
<p>上面的module1模块需要使用jQuery库和YUI库，就把这两个库（其实是两个模块）当作参数输入module1。这样做除了保证模块的独立性，还使得模块之间的依赖关系变得明显。这方面更多的讨论，参见Ben Cherry的著名文章《JavaScript Module Pattern: In-Depth》。</p>
<h2 id="模块的规范"><a href="#模块的规范" class="headerlink" title="模块的规范"></a>模块的规范</h2><p>先想一想，为什么模块很重要？<br>因为有了模块，我们就可以更方便地使用别人的代码，想要什么功能，就加载什么模块。<br>但是，这样做有一个前提，那就是大家必须以同样的方式编写模块，否则你有你的写法，我有我的写法，岂不是乱了套！考虑到Javascript模块现在还没有官方规范，这一点就更重要了。<br>目前，通行的Javascript模块规范共有两种：CommonJS和AMD。我主要介绍AMD，但是要先从CommonJS讲起。<br>八、CommonJS<br>2009年，美国程序员Ryan Dahl创造了node.js项目，将javascript语言用于服务器端编程。</p>
<p>这标志”Javascript模块化编程”正式诞生。因为老实说，在浏览器环境下，没有模块也不是特别大的问题，毕竟网页程序的复杂性有限；但是在服务器端，一定要有模块，与操作系统和其他应用程序互动，否则根本没法编程。<br>node.js的模块系统，就是参照CommonJS规范实现的。在CommonJS中，有一个全局性方法require()，用于加载模块。假定有一个数学模块math.js，就可以像下面这样加载。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">　　<span class="keyword">var</span> math = <span class="built_in">require</span>(<span class="string">'math'</span>);</div></pre></td></tr></table></figure></p>
<p>然后，就可以调用模块提供的方法：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">　　<span class="keyword">var</span> math = <span class="built_in">require</span>(<span class="string">'math'</span>);</div><div class="line">　　math.add(<span class="number">2</span>,<span class="number">3</span>); <span class="comment">// 5</span></div></pre></td></tr></table></figure></p>
<p>因为这个系列主要针对浏览器编程，不涉及node.js，所以对CommonJS就不多做介绍了。我们在这里只要知道，require()用于加载模块就行了。</p>
<h2 id="浏览器环境"><a href="#浏览器环境" class="headerlink" title="浏览器环境"></a>浏览器环境</h2><p>有了服务器端模块以后，很自然地，大家就想要客户端模块。而且最好两者能够兼容，一个模块不用修改，在服务器和浏览器都可以运行。<br>但是，由于一个重大的局限，使得CommonJS规范不适用于浏览器环境。还是上一节的代码，如果在浏览器中运行，会有一个很大的问题，你能看出来吗？<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">　　<span class="keyword">var</span> math = <span class="built_in">require</span>(<span class="string">'math'</span>);</div><div class="line">　　math.add(<span class="number">2</span>, <span class="number">3</span>);</div></pre></td></tr></table></figure></p>
<p>第二行math.add(2, 3)，在第一行require(‘math’)之后运行，因此必须等math.js加载完成。也就是说，如果加载时间很长，整个应用就会停在那里等。<br>这对服务器端不是一个问题，因为所有的模块都存放在本地硬盘，可以同步加载完成，等待时间就是硬盘的读取时间。但是，对于浏览器，这却是一个大问题，因为模块都放在服务器端，等待时间取决于网速的快慢，可能要等很长时间，浏览器处于”假死”状态。<br>因此，浏览器端的模块，不能采用”同步加载”（synchronous），只能采用”异步加载”（asynchronous）。这就是AMD规范诞生的背景。</p>
<h2 id="AMD"><a href="#AMD" class="headerlink" title="AMD"></a>AMD</h2><p>AMD是”Asynchronous Module Definition”的缩写，意思就是”异步模块定义”。它采用异步方式加载模块，模块的加载不影响它后面语句的运行。所有依赖这个模块的语句，都定义在一个回调函数中，等到加载完成之后，这个回调函数才会运行。<br>AMD也采用require()语句加载模块，但是不同于CommonJS，它要求两个参数：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">　　<span class="built_in">require</span>([<span class="built_in">module</span>], callback);</div></pre></td></tr></table></figure></p>
<p>第一个参数[module]，是一个数组，里面的成员就是要加载的模块；第二个参数callback，则是加载成功之后的回调函数。如果将前面的代码改写成AMD形式，就是下面这样：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">　　<span class="built_in">require</span>([<span class="string">'math'</span>], <span class="function"><span class="keyword">function</span> (<span class="params">math</span>) </span>&#123;</div><div class="line">　　　　math.add(<span class="number">2</span>, <span class="number">3</span>);</div><div class="line">　　&#125;);</div></pre></td></tr></table></figure></p>
<p>math.add()与math模块加载不是同步的，浏览器不会发生假死。所以很显然，AMD比较适合浏览器环境。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/07/js-modden-coder/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Mr.Hua">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Mr.Hua's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Mr.Hua's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/07/js-modden-coder/" itemprop="url">
                  JavaScript 模块化编程 - Module Pattern
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Veröffentlicht am</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-07T17:11:53+08:00">
                2016-12-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">in</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/es6/" itemprop="url" rel="index">
                    <span itemprop="name">es6</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>前言</p>
<p>The Module Pattern，模块模式，也译为模组模式，是一种通用的对代码进行模块化组织与定义的方式。这里所说的模块（Modules），是指实现某特定功能的一组方法和代码。许多现代语言都定义了代码的模块化组织方式，比如 Golang 和 Java，它们都使用 package 与 import 来管理与使用模块，而目前版本的 JavaScript 并未提供一种原生的、语言级别的模块化组织模式，而是将模块化的方法交由开发者来实现。因此，出现了很多种 JavaScript 模块化的实现方式，比如，CommonJS Modules、AMD 等。</p>
<p>以 AMD 为例，该规范使用 define 函数来定义模块。使用 AMD 规范进行模块化编程是很简单的，大致上的结构是这样的：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">define(factory()&#123;</div><div class="line">  <span class="comment">// 模块代码</span></div><div class="line">  <span class="comment">// return something;</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>目前尚在制定中的 Harmony/ECMAScript 6（也称为 ES.next），会对模块作出语言级别的定义，但距离实用尚遥不可及，这里暂时不讨论它。</p>
<p>作为一种模式，模块模式其实一直伴随着 JavaScript 存在，与 ES 6 无关。最近我需要重构自己的一些代码，因此我参考和总结了一些实用的模块化编程实践，以便更好的组织我的代码。需要注意的是，本文只是个人的一个总结，比较简单和片面，详尽的内容与剖析请参看文后的参考资料，它们写得很好。本文并不关心模块如何载入，只关心现今该如何组织模块化的代码。还有，不必过于纠结所谓的模式，真正重要的其实还是模块代码及思想。所谓模式，不过是我们书写代码的一些技巧和经验的总结，是一些惯用法，实践中应灵活运用。</p>
<h2 id="模块模式"><a href="#模块模式" class="headerlink" title="模块模式"></a>模块模式</h2><h3 id="闭包与-IIFE-Immediately-Invoked-Function-Expression"><a href="#闭包与-IIFE-Immediately-Invoked-Function-Expression" class="headerlink" title="闭包与 IIFE (Immediately-Invoked Function Expression)"></a>闭包与 IIFE (Immediately-Invoked Function Expression)</h3><p>模块模式使用了 JavaScript 的一个特性，即闭包（Closures）。现今流行的一些 JS 库中经常见到以下形式的代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">;(<span class="function"><span class="keyword">function</span> (<span class="params">参数</span>) </span>&#123;</div><div class="line">  <span class="comment">// 模块代码</span></div><div class="line">  <span class="comment">// return something;</span></div><div class="line">&#125;)(参数);</div></pre></td></tr></table></figure>
<p>上面的代码定义了一个匿名函数，并立即调用自己，这叫做自调用匿名函数（SIAF），更准确一点，称为立即调用的函数表达 (Immediately-Invoked Function Expression, IIFE–读做“iffy”)。</p>
<p>在闭包中，可以定义私有变量和函数，外部无法访问它们，从而做到了私有成员的隐藏和隔离。而通过返回对象或函数，或是将某对象作为参数传入，在函数体内对该对象进行操作，就可以公开我们所希望对外暴露的公开的方法与数据。</p>
<p>这，其实就是模块模式的本质。</p>
<p>注1：上面的代码中，最后的一对括号是对匿名函数的调用，因此必不可少。而前面的一对围绕着函数表达式的一对括号并不是必需的，但它可以用来给开发人员一个指示 – 这是一个 IIFE。也有一些开发者在函数表达式前面加上一个惊叹号（!）或分号（;)，而不是用括号包起来。比如 knockoutjs 的源码大致就是这样的：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">!<span class="function"><span class="keyword">function</span> (<span class="params">参数</span>) </span>&#123;</div><div class="line">  <span class="comment">// 代码</span></div><div class="line">  <span class="comment">// return something</span></div><div class="line">&#125;(参数);</div></pre></td></tr></table></figure>
<p>还有些人喜欢用括号将整个 IIFE 围起来，这样就变成了以下的形式：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">参数</span>) </span>&#123;</div><div class="line">  <span class="comment">// 代码</span></div><div class="line">  <span class="comment">// return something</span></div><div class="line">&#125;(参数));</div></pre></td></tr></table></figure>
<p>注2：在有些人的代码中，将 undefined 作为上面代码中的一个参数，他们那样做是因为 undefined 并不是 JavaScript 的保留字，用户也可以定义它，这样，当判断某个值是否是 undefined 的时候，判断可能会是错误的。将 undefined 作为一个参数传入，是希望代码能按预期那样运行。不过我认为，一般情况下那样做并没太大意义。</p>
<h3 id="参数输入"><a href="#参数输入" class="headerlink" title="参数输入"></a>参数输入</h3><p>JavaScript 有一个特性叫做隐式全局变量（implied globals），当使用一个变量名时，JavaScript 解释器将反向遍历作用域链来查找变量的声明，如果没有找到，就假定该变量是全局变量。这种特性使得我们可以在闭包里随处引用全局变量，比如 jQuery 或 window。然而，这是一种不好的方式。</p>
<p>考虑模块的独立性和封装，对其它对象的引用应该通过参数来引入。如果模块内需要使用其它全局对象，应该将这些对象作为参数来显式引用它们，而非在模块内直接引用这些对象的名字。以 jQuery 为例，若在参数中没有输入 jQuery 对象就在模块内直接引用 $ 这个对象，是有出错的可能的。正确的方式大致应该是这样的：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">;(<span class="function"><span class="keyword">function</span> (<span class="params">q, w</span>) </span>&#123;</div><div class="line">  <span class="comment">// q is jQuery</span></div><div class="line">  <span class="comment">// w is window</span></div><div class="line">  <span class="comment">// 局部变量及代码</span></div><div class="line">  <span class="comment">// 返回</span></div><div class="line">&#125;)(jQuery, <span class="built_in">window</span>);</div></pre></td></tr></table></figure></p>
<p>相比隐式全局变量，将引用的对象作为参数，使它们得以和函数内的其它局部变量区分开来。这样做还有个好处，我们可以给那些全局对象起一个别名，比如上例中的 “q”。现在看看你的代码，是否没有经过对 jQuery 的引用就到处都是”$”？</p>
<h3 id="模块输出（Module-Export）"><a href="#模块输出（Module-Export）" class="headerlink" title="模块输出（Module Export）"></a>模块输出（Module Export）</h3><p>有时我们不只是要使用全局变量，我们也要声明和输出模块中的对象，这可以通过匿名函数的 return 语句来达成，而这也构成了一个完整的模块模式。来看一个完整的例子：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> MODULE = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> my = &#123;&#125;,</div><div class="line">        privateVariable = <span class="number">1</span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">privateMethod</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="comment">// ...</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    my.moduleProperty = <span class="number">1</span>;</div><div class="line">    my.moduleMethod = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="comment">// ...</span></div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> my;</div><div class="line">&#125;());</div></pre></td></tr></table></figure>
<p>这段代码声明了一个变量 MODULE，它带有两个可访问的属性：moduleProperty 和 moduleMethod，其它的代码都封装在闭包中保持着私有状态。参考以前提过的参数输入，我们还可以通过参数引用其它全局变量。</p>
<h4 id="输出简单对象"><a href="#输出简单对象" class="headerlink" title="输出简单对象"></a>输出简单对象</h4><p>很多时候我们 return 一个对象作为模块的输出，比如上例就是。</p>
<p>另外，使用对象直接量（Object Literal Notation）来表达 JavaScript 对象是很常见的。比如：var x = { p1: 1, p2: “2”, f: function(){ /<em>… </em>/ } }</p>
<p>很多时候我们都能见到这样的模块化代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> Module1 = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> private_variable = <span class="number">1</span>;</div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">private_method</span>(<span class="params"></span>) </span>&#123; <span class="comment">/*...*/</span> &#125;</div><div class="line"></div><div class="line">  <span class="keyword">var</span> my = &#123;</div><div class="line">    <span class="attr">property1</span>: <span class="number">1</span>,</div><div class="line">    <span class="attr">property2</span>: private_variable,</div><div class="line">    <span class="attr">method1</span>: private_method,</div><div class="line">    <span class="attr">method2</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="comment">// ...</span></div><div class="line">    &#125;</div><div class="line">  &#125;;</div><div class="line">  <span class="keyword">return</span> my;</div><div class="line">&#125;());</div></pre></td></tr></table></figure>
<p>另外，对于简单的模块化代码，若不涉及私有成员等，其实也可以直接使用对象直接量来表达一个模块：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> Widget1 = &#123;</div><div class="line">  <span class="attr">name</span>: <span class="string">"who am i?"</span>,</div><div class="line">  <span class="attr">settings</span>: &#123;</div><div class="line">    <span class="attr">x</span>: <span class="number">0</span>,</div><div class="line">    <span class="attr">y</span>: <span class="number">0</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">call_me</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">  &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>有一篇文章讲解了这种形式： How Do You Structure JavaScript? The Module Pattern Edition</p>
<p>不过这只是一种简单的形式，你可以将它看作是模块模式的一种基础的简单表达形式，而把闭包形式看作是对它的一个封装。</p>
<h4 id="输出函数"><a href="#输出函数" class="headerlink" title="输出函数"></a>输出函数</h4><p>有时候我们希望返回的并不是一个对象，而是一个函数。有两种需求要求我们返回一个函数，一种情况是我们需要它是一个函数，比如 jQuery，它是一个函数而不是一个简单对象；另一种情况是我们需要的是一个“类”而不是一个直接量，之后我们可以用 “new” 来实例它。目前版本的 JavaScript 并没有专门的“类”定义，但它却可以通过 function 来表达。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> Cat = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="comment">// 私有成员及代码 ...</span></div><div class="line"></div><div class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</div><div class="line">    <span class="keyword">this</span>.name = name;</div><div class="line">    <span class="keyword">this</span>.bark = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="comment">/*...*/</span> &#125;</div><div class="line">  &#125;;</div><div class="line">&#125;());</div><div class="line"></div><div class="line"><span class="keyword">var</span> tomcat = <span class="keyword">new</span> Cat(<span class="string">"Tom"</span>);</div><div class="line">tomcat.bark();</div></pre></td></tr></table></figure>
<p>为什么不直接定义一个 function 而要把它放在闭包里呢？简单点的情况，确实不需要使用 IIFE 这种形式，但复杂点的情况，在构造我们所需要的函数或是“类”时，若需要定义一些私有的函数，就有必要使用 IIFE 这种形式了。</p>
<p>另外，在 ECMAScript 第五版中，提出了 Object.create() 方法。这时可以将一个对象视作“类”，并使用 Object.create() 进行实例化，不需使用 “new”。</p>
<h3 id="Revealing-Module-Pattern"><a href="#Revealing-Module-Pattern" class="headerlink" title="Revealing Module Pattern"></a>Revealing Module Pattern</h3><p>前面已经提到一种形式是输出对象直接量（Object Literal Notation），而 Revealing Module Pattern 其实就是这种形式，只是做了一些限定。这种模式要求在私有范围内中定义变量和函数，然后返回一个匿名对象，在该对象中指定要公开的成员。参见下面的代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> MODULE = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="comment">// 私有变量及函数</span></div><div class="line">  <span class="keyword">var</span> x = <span class="number">1</span>;</div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">f1</span>(<span class="params"></span>) </span>&#123;&#125;</div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">f2</span>(<span class="params"></span>) </span>&#123;&#125;</div><div class="line"></div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">public_method1</span>: f1,</div><div class="line">    <span class="attr">public_method2</span>: f2</div><div class="line">  &#125;;</div><div class="line">&#125;());</div></pre></td></tr></table></figure>
<h2 id="模块模式的变化"><a href="#模块模式的变化" class="headerlink" title=" 模块模式的变化"></a> 模块模式的变化</h2><h3 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h3><p>上面的举例都是在一个地方定义模块，如果我们需要在数个文件中分别编写一个模块的不同部分该怎么办呢？或者说，如果我们需要对已有的模块作出扩展该怎么办呢？其实也很简单，将模块对象作为参数输入，扩展后再返回自己就可以了。比如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> MODULE = (<span class="function"><span class="keyword">function</span> (<span class="params">my</span>) </span>&#123;</div><div class="line">  my.anotherMethod = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="comment">// added method...</span></div><div class="line">  &#125;;</div><div class="line"></div><div class="line">  <span class="keyword">return</span> my;</div><div class="line">&#125;(MODULE));</div></pre></td></tr></table></figure>
<p>上面的代码为对象 MODULE 增加了一个 “anotherMethod” 方法。</p>
<h3 id="松耦合扩展（Loose-Augmentation）"><a href="#松耦合扩展（Loose-Augmentation）" class="headerlink" title="松耦合扩展（Loose Augmentation）"></a>松耦合扩展（Loose Augmentation）</h3><p>上面的代码要求 MODULE 对象是已经定义过的。如果这个模块的各个组成部分并没有加载顺序要求的话，其实可以允许输入的参数为空对象，那么我们将上例中的参数由 MODULE 改为 MODULE || {} 就可以了：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> MODULE = (<span class="function"><span class="keyword">function</span> (<span class="params">my</span>) </span>&#123;</div><div class="line">  <span class="comment">// add capabilities...</span></div><div class="line">  <span class="keyword">return</span> my;</div><div class="line">&#125;(MODULE || &#123;&#125;));</div></pre></td></tr></table></figure>
<h3 id="紧耦合扩展（Tight-Augmentation）"><a href="#紧耦合扩展（Tight-Augmentation）" class="headerlink" title="紧耦合扩展（Tight Augmentation）"></a>紧耦合扩展（Tight Augmentation）</h3><p>与上例不同，有时我们要求在扩展时调用以前已被定义的方法，这也有可能被用于覆盖已有的方法。这时，对模块的定义顺序是有要求的。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> MODULE = (<span class="function"><span class="keyword">function</span> (<span class="params">my</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> old_moduleMethod = my.moduleMethod;</div><div class="line"></div><div class="line">  my.moduleMethod = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="comment">// 方法重载</span></div><div class="line">    <span class="comment">// 可通过 old_moduleMethod 调用以前的方法...</span></div><div class="line">  &#125;;</div><div class="line"></div><div class="line">  <span class="keyword">return</span> my;</div><div class="line">&#125;(MODULE));</div></pre></td></tr></table></figure>
<h3 id="克隆与继承（Cloning-and-Inheritance）"><a href="#克隆与继承（Cloning-and-Inheritance）" class="headerlink" title="克隆与继承（Cloning and Inheritance）"></a>克隆与继承（Cloning and Inheritance）</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> MODULE_TWO = (<span class="function"><span class="keyword">function</span> (<span class="params">old</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> my = &#123;&#125;,</div><div class="line">        key;</div><div class="line"></div><div class="line">    <span class="keyword">for</span> (key <span class="keyword">in</span> old) &#123;</div><div class="line">        <span class="keyword">if</span> (old.hasOwnProperty(key)) &#123;</div><div class="line">            my[key] = old[key];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> super_moduleMethod = old.moduleMethod;</div><div class="line">    my.moduleMethod = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="comment">// override method on the clone, access to super through super_moduleMethod</span></div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> my;</div><div class="line">&#125;(MODULE));</div></pre></td></tr></table></figure>
<p>有时我们需要复制和继承原对象，上面的代码演示了这种操作，但未必完美。如果你可以使用 Object.create() 的话，请使用 Object.create() 来改写上面的代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> MODULE_TWO = (<span class="function"><span class="keyword">function</span> (<span class="params">old</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> my = <span class="built_in">Object</span>.create(old);</div><div class="line"></div><div class="line">  <span class="keyword">var</span> super_moduleMethod = old.moduleMethod;</div><div class="line">  my.moduleMethod = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="comment">// override method ...</span></div><div class="line">  &#125;;</div><div class="line"></div><div class="line">  <span class="keyword">return</span> my;</div><div class="line">&#125;(MODULE));</div></pre></td></tr></table></figure>
<h3 id="子模块（Sub-modules）"><a href="#子模块（Sub-modules）" class="headerlink" title="子模块（Sub-modules）"></a>子模块（Sub-modules）</h3><p>模块对象当然可以再包含子模块，形如 MODULE.Sub=(function(){}()) 之类，这里不再展开叙述了。</p>
<h3 id="各种形式的混合"><a href="#各种形式的混合" class="headerlink" title="各种形式的混合"></a>各种形式的混合</h3><p>以上介绍了常见的几种模块化形式，实际应用中有可能是这些形式的混合体。比如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> UTIL = (<span class="function"><span class="keyword">function</span> (<span class="params">parent, $</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> my = parent.ajax = parent.ajax || &#123;&#125;;</div><div class="line"></div><div class="line">    my.get = <span class="function"><span class="keyword">function</span> (<span class="params">url, params, callback</span>) </span>&#123;</div><div class="line">        <span class="comment">// ok, so I'm cheating a bit :)</span></div><div class="line">        <span class="keyword">return</span> $.getJSON(url, params, callback);</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="comment">// etc...</span></div><div class="line"></div><div class="line">    <span class="keyword">return</span> parent;</div><div class="line">&#125;(UTIL || &#123;&#125;, jQuery));</div></pre></td></tr></table></figure>
<h2 id="与其它模块规范或-JS-库的适配"><a href="#与其它模块规范或-JS-库的适配" class="headerlink" title="与其它模块规范或 JS 库的适配"></a>与其它模块规范或 JS 库的适配</h2><h3 id="模块环境探测"><a href="#模块环境探测" class="headerlink" title="模块环境探测"></a>模块环境探测</h3><p>现今，CommonJS Modules 与 AMD 有着广泛的应用，如果确定 AMD 的 define 是可用的，我们当然可以使用 define 来编写模块化的代码。然而，我们不能假定我们的代码必然运行于 AMD 环境下。有没有办法可以让我们的代码既兼容于 CommonJS Modules 或 AMD 规范，又能在一般环境下运行呢？</p>
<p>其实我们只需要在某个地方加上对 CommonJS Modules 与 AMD 的探测并根据探测结果来“注册”自己就可以了，以上那些模块模式仍然有用。</p>
<p>AMD 定义了 define 函数，我们可以使用 typeof 探测该函数是否已定义。若要更严格一点，可以继续判断 define.amd 是否有定义。另外，SeaJS 也使用了 define 函数，但和 AMD 的 define 又不太一样。</p>
<p>对于 CommonJS，可以检查 exports 或是 module.exports 是否有定义。</p>
<p>现在，我写一个比较直白的例子来展示这个过程：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> MODULE = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> my = &#123;&#125;;</div><div class="line">  <span class="comment">// 代码 ...</span></div><div class="line"></div><div class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> define == <span class="string">'function'</span>) &#123;</div><div class="line">    define( <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">return</span> my; &#125; );</div><div class="line">  &#125;<span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">module</span> != <span class="string">'undefined'</span> &amp;&amp; <span class="built_in">module</span>.exports) &#123;</div><div class="line">    <span class="built_in">module</span>.exports = my;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> my;</div><div class="line">&#125;());</div></pre></td></tr></table></figure>
<p>上面的代码在返回 my 对象之前，先检测自己是否是运行在 AMD 环境之中（检测 define 函数是否有定义），如果是，就使用 define 来定义模块，否则，继续检测是否运行于 CommonJS 中，比如 NodeJS，如果是，则将 my 赋值给 module.exports。因此，这段代码应该可以同时运行于 AMD、CommonJS 以及一般的环境之中。另外，我们的这种写法应该也可在 SeaJS 中正确执行。</p>
<h3 id="其它一些-JS-库的做法"><a href="#其它一些-JS-库的做法" class="headerlink" title="其它一些 JS 库的做法"></a>其它一些 JS 库的做法</h3><p>现在许多 JS 库都加入了对 AMD 或 CommonJS Modules 的适应，比如 jQuery, Mustache, doT, Juicer 等。</p>
<p>jQuery 的写法可参考 exports.js:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> ( <span class="keyword">typeof</span> <span class="built_in">module</span> === <span class="string">"object"</span> &amp;&amp; <span class="built_in">module</span> &amp;&amp; <span class="keyword">typeof</span> <span class="built_in">module</span>.exports === <span class="string">"object"</span> ) &#123;</div><div class="line">    <span class="built_in">module</span>.exports = jQuery;</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">    <span class="keyword">if</span> ( <span class="keyword">typeof</span> define === <span class="string">"function"</span> &amp;&amp; define.amd ) &#123;</div><div class="line">        define( <span class="string">"jquery"</span>, [], <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">return</span> jQuery; &#125; );</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">if</span> ( <span class="keyword">typeof</span> <span class="built_in">window</span> === <span class="string">"object"</span> &amp;&amp; <span class="keyword">typeof</span> <span class="built_in">window</span>.document === <span class="string">"object"</span> ) &#123;</div><div class="line">    <span class="built_in">window</span>.jQuery = <span class="built_in">window</span>.$ = jQuery;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>与前面我写的那段代码有些不同，在对 AMD 和 CommonJS 探测之后，它将 jQuery 注册成了 window 对象的成员。</p>
<p>然而，jQuery 是一个浏览器端的 JS 库，它那样写当然没问题。但如果我们所写的是一个通用的库，就不应使用 window 对象了，而应该使用全局对象，而这一般可以使用 this 来得到。</p>
<p>我们看看 Mustache 是怎么做的：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">root, factory</span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> exports === <span class="string">"object"</span> &amp;&amp; exports) &#123;</div><div class="line">    factory(exports); <span class="comment">// CommonJS</span></div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    <span class="keyword">var</span> mustache = &#123;&#125;;</div><div class="line">    factory(mustache);</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> define === <span class="string">"function"</span> &amp;&amp; define.amd) &#123;</div><div class="line">      define(mustache); <span class="comment">// AMD</span></div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      root.Mustache = mustache; <span class="comment">// &lt;script&gt;</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span> (<span class="params">mustache</span>) </span>&#123;</div><div class="line">  <span class="comment">// 模块主要的代码放在这儿</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>这段代码与前面介绍的方式不太一样，它使用了两个匿名函数。后面那个函数可以看作是模块代码的工厂函数，它是模块的主体部分。前面那个函数对运行环境进行检测，根据检测的结果对模块的工厂函数进行调用。另外，作为一个通用库，它并没使用 window 对象，而是使用了 this，因为在简单的函数调用中，this 其实就是全局对象。</p>
<p>再看看 doT 的做法。doT 的做法与 Mustache 不同，而是更接近于我在前面介绍 AMD 环境探测的那段代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line"><span class="meta">    "use strict"</span>;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> doT = &#123;</div><div class="line">        <span class="attr">version</span>: <span class="string">'1.0.0'</span>,</div><div class="line">        <span class="attr">templateSettings</span>: &#123; <span class="comment">/*...*/</span> &#125;,</div><div class="line">        <span class="attr">template</span>: <span class="literal">undefined</span>, <span class="comment">//fn, compile template</span></div><div class="line">        compile:  <span class="literal">undefined</span>  <span class="comment">//fn, for express</span></div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">module</span> !== <span class="string">'undefined'</span> &amp;&amp; <span class="built_in">module</span>.exports) &#123;</div><div class="line">        <span class="built_in">module</span>.exports = doT;</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> define === <span class="string">'function'</span> &amp;&amp; define.amd) &#123;</div><div class="line">        define(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="keyword">return</span> doT;&#125;);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">return</span> <span class="keyword">this</span> || (<span class="number">0</span>,<span class="built_in">eval</span>)(<span class="string">'this'</span>); &#125;()).doT = doT;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">&#125;());</div></pre></td></tr></table></figure>
<p>这段代码里的 (0, eval)(‘this’) 是一个小技巧，这个表达式用来得到 Global 对象，’this’ 其实是传递给 eval 的参数，但由于 eval 是经由 (0, eval) 这个表达式间接得到的，因此 eval 将会在全局对象作用域中查找 this，结果得到的是全局对象。若是代码运行于浏览器中，那么得到的其实是 window 对象。这里有一个针对它的讨论： <a href="http://stackoverflow.com/questions/14119988/return-this-0-evalthis/14120023#14120023" target="_blank" rel="external">http://stackoverflow.com/questions/14119988/return-this-0-evalthis/14120023#14120023</a></p>
<p>其实也有其它办法来获取全局对象的，比如，使用函数的 call 或 apply，但不给参数，或是传入 null：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> global_object = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>; &#125;).call();</div></pre></td></tr></table></figure>
<p>你可以参考这篇文章： Javascript的this用法</p>
<p>Juicer 则没有检测 AMD，它使用了如下的语句来检测 CommonJS Modules：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typeof</span>(<span class="built_in">module</span>) !== <span class="string">'undefined'</span> &amp;&amp; <span class="built_in">module</span>.exports ? <span class="built_in">module</span>.exports = juicer : <span class="keyword">this</span>.juicer = juicer;</div></pre></td></tr></table></figure>
<p>另外，你还可以参考一下这个： <a href="https://gist.github.com/kitcambridge/1251221" target="_blank" rel="external">https://gist.github.com/kitcambridge/1251221</a><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">root, Library</span>) </span>&#123;</div><div class="line">  <span class="comment">// The square bracket notation is used to avoid property munging by the Closure Compiler.</span></div><div class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> define == <span class="string">"function"</span> &amp;&amp; <span class="keyword">typeof</span> define[<span class="string">"amd"</span>] == <span class="string">"object"</span> &amp;&amp; define[<span class="string">"amd"</span>]) &#123;</div><div class="line">    <span class="comment">// Export for asynchronous module loaders (e.g., RequireJS, `curl.js`).</span></div><div class="line">    define([<span class="string">"exports"</span>], Library);</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    <span class="comment">// Export for CommonJS environments, web browsers, and JavaScript engines.</span></div><div class="line">    Library = Library(<span class="keyword">typeof</span> exports == <span class="string">"object"</span> &amp;&amp; exports || (root[<span class="string">"Library"</span>] = &#123;</div><div class="line">      <span class="string">"noConflict"</span>: (<span class="function"><span class="keyword">function</span> (<span class="params">original</span>) </span>&#123;</div><div class="line">        <span class="function"><span class="keyword">function</span> <span class="title">noConflict</span>(<span class="params"></span>) </span>&#123;</div><div class="line">          root[<span class="string">"Library"</span>] = original;</div><div class="line">          <span class="comment">// `noConflict` can't be invoked more than once.</span></div><div class="line">          <span class="keyword">delete</span> Library.noConflict;</div><div class="line">          <span class="keyword">return</span> Library;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> noConflict;</div><div class="line">      &#125;)(root[<span class="string">"Library"</span>])</div><div class="line">    &#125;));</div><div class="line">  &#125;</div><div class="line">&#125;)(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span> (<span class="params">exports</span>) </span>&#123;</div><div class="line">  <span class="comment">// ...</span></div><div class="line">  <span class="keyword">return</span> exports;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>我觉得这个写得有些复杂了，我也未必需要我的库带有 noConflict 方法。不过，它也可以是个不错的参考。</p>
<h2 id="JavaScript-模块化的未来"><a href="#JavaScript-模块化的未来" class="headerlink" title=" JavaScript 模块化的未来"></a> JavaScript 模块化的未来</h2><p>未来的模块化方案会是什么样的？我不知道，但不管将来如何演化，作为一种模式，模块模式是不会过时和消失的。</p>
<p>如前所述，尚在制定中的 ES 6 会对模块作出语言级别的定义。我们来看一个实例，以下的代码段摘自“ES6:JavaScript中将会有的几个新东西”：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">module</span> Car &#123;</div><div class="line">  <span class="comment">// 内部变量</span></div><div class="line">  <span class="keyword">var</span> licensePlateNo = <span class="string">'556-343'</span>;</div><div class="line">  <span class="comment">// 暴露到外部的变量和函数</span></div><div class="line">  <span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">drive</span>(<span class="params">speed, direction</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'details:'</span>, speed, direction);</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">export</span> <span class="built_in">module</span> engine&#123;</div><div class="line">    <span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"></span>) </span>&#123; &#125;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">export</span> <span class="keyword">var</span> miles = <span class="number">5000</span>;</div><div class="line">  <span class="keyword">export</span> <span class="keyword">var</span> color = <span class="string">'silver'</span>;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>我不知道 ES 6 将来会否对此作出改变，对上面的这种代码形式，不同的人会有不同的看法。就我个人而言，我十分不喜欢这种形式！</p>
<p>确实，我们可能需要有一种统一的模块化定义方式。发明 AMD 和 RequireJS 的人也说过 AMD 和 RequireJS 应该被淘汰了，运行环境应该提供模块的原生支持。然而，ES 6 中的模块定义是否是正确的？它是否是一个好的解决方案呢？我不知道，但我个人真的很不喜欢那种方式。很多人十分喜欢把其它语言的一些东西生搬硬套到 JavaScript 中，或是孜孜不倦地要把 JavaScript 变成另外一种语言，我相当讨厌这种行为。我并非一个保守的人，我乐意接受新概念、新语法，只要它是好的。但是，ES 6 草案中的模块规范是我不喜欢的，起码，我认为它脱离了现实，否定了开源社区的实践和经验，是一种意淫出来的东西，这使得它在目前不能解决任何实际问题，反而是来添乱的。</p>
<p>按目前的 ES6 草案所给出的模块化规范，它并没有采用既有的 CommonJS Modules 和 AMD 规范，而是定义了一种新的规范，而且这种规范修改了 JavaScript 既有的语法形式，使得它没有办法像 ES5 中的 Object.create、Array.forEach 那样可以利用现有版本的 JavaScript 编写一些代码来实现它。这也使得 ES 6 的模块化语法将在一段时期内处于不可用的状态。</p>
<p>引入新的语法也不算是问题，然而，为了模块而大费周折引出那么多新的语法和定义，真的是一种好的选择么？话说，它解决了什么实质性的问题而非如此不可？现今流行的 AMD 其实简单到只定义了一个 “define” 函数，它有什么重大问题？就算那些专家因种种原因或目的而无法接受 AMD 或其它开源社区的方案，稍作出一些修改和中和总是可以的吧，非要把 JavaScript 改头换面不可么？确实有人写了一些观点来解释为何不用 AMD，然而，那些解释和观点其实大都站不住脚。比如说，其中一个解释是 AMD 规范不兼容于 ES 6！可笑不可笑？ES 6 尚未正式推出，完全实现了 ES 6 的 JavaScript 运行时也没几个，而 AMD 在开源社区中早已十分流行，这个时候说 AMD 不兼容 ES 6，我不知道这是什么意思。</p>
<p>就我看来，现今各种形形色色的所谓标准化工作组，很多时候像是高高在上的神仙，他们拉不下脸全身心地参与到开源社区之中，他们就是要作出与开源社区不同的规范，以此来彰显他们的工作、专业与权威。而且，很多时候他们过于官僚，又或者夹杂在各大商业集团之间举棋不定。我不否认他们工作的重要性，然而，以专家自居而脱离或否定开源社区的实践，以及商业与政治的利益均衡等，使得他们的工作与开源社区相比，在技术的推动与发展上成效不足甚至添乱。</p>
<p>回到 ES 6 中的模块，想想看，我需要修改我的代码，在其中加上诸如 module, export, import 之类的新的语法，修改之后的代码却没办法在现今版本的 JavaScript 中运行，而且，与现今流行的模块化方案相比，这些工作也没什么实质性的帮助，想想这些，我只感觉像是吃了一个苍蝇。</p>
<p>ES 6 的发展当然不会因为我的吐嘈而有任何变化，我也不愿再展开讨论。未来的模块化方案具体是什么样的无法知晓，但起码我可以得到以下的结论：</p>
<p>模块模式不会过时<br>ES 6 不会接纳 AMD 等现有方案，但不管如何，JavaScript 将会有语言级别的模块定义<br>ES 6 中的模块在一段时期内是不可用的<br>即使 ES 6 已达到实用阶段，现今的模块化方案仍会存在和发展</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/07/how-to-write-amd-cmd-umd/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Mr.Hua">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Mr.Hua's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Mr.Hua's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/07/how-to-write-amd-cmd-umd/" itemprop="url">
                  AMD、CMD、UMD 模块的写法
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Veröffentlicht am</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-07T17:05:28+08:00">
                2016-12-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">in</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/es6/" itemprop="url" rel="index">
                    <span itemprop="name">es6</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>简介</p>
<p>最近几年，我们可以选择的Javascript组件的生态系统一直在稳步增长。虽然陡增的选择范围是极好的，但当组件混合匹配使用时就会出现很尴尬的局面。开发新手们会很快发现不是所有组件都能彼此“和平相处”。</p>
<p>为了解决这个问题，两种竞争关系的模块规范AMD和CommonJS问世了，它们允许开发者遵照一种约定的沙箱化和模块化的方式来写代码，这样就能避免“污染生态系统”。</p>
<h2 id="AMD"><a href="#AMD" class="headerlink" title="AMD"></a>AMD</h2><p>随着RequireJS成为最流行的实现方式，异步模块规范（AMD）在前端界已经被广泛认同。</p>
<p>下面是只依赖jquery的模块foo的代码：</p>
<p>JavaScript<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//    文件名: foo.js</span></div><div class="line">define([<span class="string">'jquery'</span>], <span class="function"><span class="keyword">function</span> (<span class="params">$</span>) </span>&#123;</div><div class="line">    <span class="comment">//    方法</span></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">myFunc</span>(<span class="params"></span>)</span>&#123;&#125;;</div><div class="line"></div><div class="line">    <span class="comment">//    暴露公共方法</span></div><div class="line">    <span class="keyword">return</span> myFunc;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//    文件名: foo.js</span></div><div class="line">define([<span class="string">'jquery'</span>], <span class="function"><span class="keyword">function</span> (<span class="params">$</span>) </span>&#123;</div><div class="line">    <span class="comment">//    方法</span></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">myFunc</span>(<span class="params"></span>)</span>&#123;&#125;;</div><div class="line"></div><div class="line">    <span class="comment">//    暴露公共方法</span></div><div class="line">    <span class="keyword">return</span> myFunc;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>还有稍微复杂点的例子，下面的代码依赖了多个组件并且暴露多个方法:</p>
<p>JavaScript<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 文件名: foo.js</span></div><div class="line">define([<span class="string">'jquery'</span>, <span class="string">'underscore'</span>], <span class="function"><span class="keyword">function</span> (<span class="params">$, _</span>) </span>&#123;</div><div class="line"><span class="comment">// 方法</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>)</span>&#123;&#125;; <span class="comment">// 私有方法，因为没有被返回(见下面)</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>)</span>&#123;&#125;; <span class="comment">// 公共方法，因为被返回了</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">c</span>(<span class="params"></span>)</span>&#123;&#125;; <span class="comment">// 公共方法，因为被返回了</span></div><div class="line">     <span class="comment">//    暴露公共方法</span></div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">        <span class="attr">b</span>: b,</div><div class="line">        <span class="attr">c</span>: c</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 文件名: foo.js</span></div><div class="line">define([<span class="string">'jquery'</span>, <span class="string">'underscore'</span>], <span class="function"><span class="keyword">function</span> (<span class="params">$, _</span>) </span>&#123;</div><div class="line"><span class="comment">// 方法</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>)</span>&#123;&#125;; <span class="comment">// 私有方法，因为没有被返回(见下面)</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>)</span>&#123;&#125;; <span class="comment">// 公共方法，因为被返回了</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">c</span>(<span class="params"></span>)</span>&#123;&#125;; <span class="comment">// 公共方法，因为被返回了</span></div><div class="line">     <span class="comment">//    暴露公共方法</span></div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">        <span class="attr">b</span>: b,</div><div class="line">        <span class="attr">c</span>: c</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>定义的第一个部分是一个依赖数组，第二个部分是回调函数，只有当依赖的组件可用时（像RequireJS这样的脚本加载器会负责这一部分，包括找到文件路径）回调函数才被执行。</p>
<p>注意，依赖组件和变量的顺序是一一对应的（例如，jquery-&gt;$, underscore-&gt;_）。</p>
<p>同时注意，我们可以用任意的变量名来表示依赖组件。假如我们把$改成$$，在函数体里面的所有对jQuery的引用都由$变成了$$。</p>
<p>还要注意，最重要的是你不能在回调函数外面引用变量$和_，因为它相对其它代码是独立的。这正是模块化的目的所在！</p>
<h2 id="CommonJS"><a href="#CommonJS" class="headerlink" title="CommonJS"></a>CommonJS</h2><p>如果你用Node写过东西的话，你可能会熟悉CommonJS的风格（node使用的格式与之相差无几）。因为有Browserify，它也一直被前端界广泛认同。</p>
<p>就像前面的格式一样，下面是用CommonJS规范实现的foo模块的写法：</p>
<p>JavaScript<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//    文件名: foo.js</span></div><div class="line"><span class="comment">//    依赖</span></div><div class="line"><span class="keyword">var</span> $ = <span class="built_in">require</span>(<span class="string">'jquery'</span>);</div><div class="line"><span class="comment">//    方法</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">myFunc</span>(<span class="params"></span>)</span>&#123;&#125;;</div><div class="line"></div><div class="line"><span class="comment">//    暴露公共方法（一个）</span></div><div class="line"><span class="built_in">module</span>.exports = myFunc;</div></pre></td></tr></table></figure></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//    文件名: foo.js</span></div><div class="line"><span class="comment">//    依赖</span></div><div class="line"><span class="keyword">var</span> $ = <span class="built_in">require</span>(<span class="string">'jquery'</span>);</div><div class="line"><span class="comment">//    方法</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">myFunc</span>(<span class="params"></span>)</span>&#123;&#125;;</div><div class="line"></div><div class="line"><span class="comment">//    暴露公共方法（一个）</span></div><div class="line"><span class="built_in">module</span>.exports = myFunc;</div></pre></td></tr></table></figure>
<p>还有更复杂的例子，下面的代码依赖了多个组件并且暴露多个方法：</p>
<p>JavaScript<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//    文件名: foo.js</span></div><div class="line"><span class="keyword">var</span> $ = <span class="built_in">require</span>(<span class="string">'jquery'</span>);</div><div class="line"><span class="keyword">var</span> _ = <span class="built_in">require</span>(<span class="string">'underscore'</span>);</div><div class="line"></div><div class="line"><span class="comment">//    methods</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>)</span>&#123;&#125;;    <span class="comment">//    私有方法，因为它没在module.exports中 (见下面)</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>)</span>&#123;&#125;;    <span class="comment">//    公共方法，因为它在module.exports中定义了</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">c</span>(<span class="params"></span>)</span>&#123;&#125;;    <span class="comment">//    公共方法，因为它在module.exports中定义了</span></div><div class="line"></div><div class="line"><span class="comment">//    暴露公共方法</span></div><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">    <span class="attr">b</span>: b,</div><div class="line">    <span class="attr">c</span>: c</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//    文件名: foo.js</span></div><div class="line"><span class="keyword">var</span> $ = <span class="built_in">require</span>(<span class="string">'jquery'</span>);</div><div class="line"><span class="keyword">var</span> _ = <span class="built_in">require</span>(<span class="string">'underscore'</span>);</div><div class="line"></div><div class="line"><span class="comment">//    methods</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>)</span>&#123;&#125;;    <span class="comment">//    私有方法，因为它没在module.exports中 (见下面)</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>)</span>&#123;&#125;;    <span class="comment">//    公共方法，因为它在module.exports中定义了</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">c</span>(<span class="params"></span>)</span>&#123;&#125;;    <span class="comment">//    公共方法，因为它在module.exports中定义了</span></div><div class="line"></div><div class="line"><span class="comment">//    暴露公共方法</span></div><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">    <span class="attr">b</span>: b,</div><div class="line">    <span class="attr">c</span>: c</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h2 id="UMD-通用模块规范"><a href="#UMD-通用模块规范" class="headerlink" title="UMD: 通用模块规范"></a>UMD: 通用模块规范</h2><p>既然CommonJs和AMD风格一样流行，似乎缺少一个统一的规范。所以人们产生了这样的需求，希望有支持两种风格的“通用”模式，于是通用模块规范（UMD）诞生了。</p>
<p>不得不承认，这个模式略难看，但是它兼容了AMD和CommonJS，同时还支持老式的“全局”变量规范：<br>JavaScript<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">root, factory</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> define === <span class="string">'function'</span> &amp;&amp; define.amd) &#123;</div><div class="line">        <span class="comment">// AMD</span></div><div class="line">        define([<span class="string">'jquery'</span>], factory);</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> exports === <span class="string">'object'</span>) &#123;</div><div class="line">        <span class="comment">// Node, CommonJS之类的</span></div><div class="line">        <span class="built_in">module</span>.exports = factory(<span class="built_in">require</span>(<span class="string">'jquery'</span>));</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="comment">// 浏览器全局变量(root 即 window)</span></div><div class="line">        root.returnExports = factory(root.jQuery);</div><div class="line">    &#125;</div><div class="line">&#125;(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span> (<span class="params">$</span>) </span>&#123;</div><div class="line">    <span class="comment">//    方法</span></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">myFunc</span>(<span class="params"></span>)</span>&#123;&#125;;</div><div class="line"></div><div class="line">    <span class="comment">//    暴露公共方法</span></div><div class="line">    <span class="keyword">return</span> myFunc;</div><div class="line">&#125;));</div></pre></td></tr></table></figure></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">root, factory</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> define === <span class="string">'function'</span> &amp;&amp; define.amd) &#123;</div><div class="line">        <span class="comment">// AMD</span></div><div class="line">        define([<span class="string">'jquery'</span>], factory);</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> exports === <span class="string">'object'</span>) &#123;</div><div class="line">        <span class="comment">// Node, CommonJS之类的</span></div><div class="line">        <span class="built_in">module</span>.exports = factory(<span class="built_in">require</span>(<span class="string">'jquery'</span>));</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="comment">// 浏览器全局变量(root 即 window)</span></div><div class="line">        root.returnExports = factory(root.jQuery);</div><div class="line">    &#125;</div><div class="line">&#125;(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span> (<span class="params">$</span>) </span>&#123;</div><div class="line">    <span class="comment">//    方法</span></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">myFunc</span>(<span class="params"></span>)</span>&#123;&#125;;</div><div class="line"></div><div class="line">    <span class="comment">//    暴露公共方法</span></div><div class="line">    <span class="keyword">return</span> myFunc;</div><div class="line">&#125;));</div></pre></td></tr></table></figure>
<p>保持跟上面例子一样的模式，下面是更复杂的例子，它依赖了多个组件并且暴露多个方法:<br>JavaScript<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">root, factory</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> define === <span class="string">'function'</span> &amp;&amp; define.amd) &#123;</div><div class="line">        <span class="comment">// AMD</span></div><div class="line">        define([<span class="string">'jquery'</span>, <span class="string">'underscore'</span>], factory);</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> exports === <span class="string">'object'</span>) &#123;</div><div class="line">        <span class="comment">// Node, CommonJS之类的</span></div><div class="line">        <span class="built_in">module</span>.exports = factory(<span class="built_in">require</span>(<span class="string">'jquery'</span>), <span class="built_in">require</span>(<span class="string">'underscore'</span>));</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="comment">// 浏览器全局变量(root 即 window)</span></div><div class="line">        root.returnExports = factory(root.jQuery, root._);</div><div class="line">    &#125;</div><div class="line">&#125;(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span> (<span class="params">$, _</span>) </span>&#123;</div><div class="line">    <span class="comment">//    方法</span></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>)</span>&#123;&#125;;    <span class="comment">//    私有方法，因为它没被返回 (见下面)</span></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>)</span>&#123;&#125;;    <span class="comment">//    公共方法，因为被返回了</span></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">c</span>(<span class="params"></span>)</span>&#123;&#125;;    <span class="comment">//    公共方法，因为被返回了</span></div><div class="line"></div><div class="line">    <span class="comment">//    暴露公共方法</span></div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">        <span class="attr">b</span>: b,</div><div class="line">        <span class="attr">c</span>: c</div><div class="line">    &#125;</div><div class="line">&#125;));</div></pre></td></tr></table></figure></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">root, factory</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> define === <span class="string">'function'</span> &amp;&amp; define.amd) &#123;</div><div class="line">        <span class="comment">// AMD</span></div><div class="line">        define([<span class="string">'jquery'</span>, <span class="string">'underscore'</span>], factory);</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> exports === <span class="string">'object'</span>) &#123;</div><div class="line">        <span class="comment">// Node, CommonJS之类的</span></div><div class="line">        <span class="built_in">module</span>.exports = factory(<span class="built_in">require</span>(<span class="string">'jquery'</span>), <span class="built_in">require</span>(<span class="string">'underscore'</span>));</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="comment">// 浏览器全局变量(root 即 window)</span></div><div class="line">        root.returnExports = factory(root.jQuery, root._);</div><div class="line">    &#125;</div><div class="line">&#125;(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span> (<span class="params">$, _</span>) </span>&#123;</div><div class="line">    <span class="comment">//    方法</span></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>)</span>&#123;&#125;;    <span class="comment">//    私有方法，因为它没被返回 (见下面)</span></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>)</span>&#123;&#125;;    <span class="comment">//    公共方法，因为被返回了</span></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">c</span>(<span class="params"></span>)</span>&#123;&#125;;    <span class="comment">//    公共方法，因为被返回了</span></div><div class="line"></div><div class="line">    <span class="comment">//    暴露公共方法</span></div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">        <span class="attr">b</span>: b,</div><div class="line">        <span class="attr">c</span>: c</div><div class="line">    &#125;</div><div class="line">&#125;));</div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/07/webpack-slow-problem/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Mr.Hua">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Mr.Hua's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Mr.Hua's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/07/webpack-slow-problem/" itemprop="url">
                  解决Webpack打包慢的问题
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Veröffentlicht am</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-07T16:55:48+08:00">
                2016-12-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">in</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/webpack/" itemprop="url" rel="index">
                    <span itemprop="name">webpack</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="问题分析"><a href="#问题分析" class="headerlink" title="问题分析"></a>问题分析</h2><p>我们先来看一下完全没有任何优化的时候，Webpack 的打包速度（使用了jsx和babel的loader）。下面是我们的测试文件：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//test.js</span></div><div class="line"><span class="keyword">var</span> react = <span class="built_in">require</span>(<span class="string">'react'</span>);</div><div class="line"><span class="keyword">var</span> ReactAddonsCssTransitionGroup = <span class="built_in">require</span>(<span class="string">'react-addons-css-transition-group'</span>);</div><div class="line"><span class="keyword">var</span> reactDOM = <span class="built_in">require</span>(<span class="string">'react-dom'</span>);</div><div class="line"><span class="keyword">var</span> reactRouter = <span class="built_in">require</span>(<span class="string">'react-router'</span>);</div><div class="line"><span class="keyword">var</span> superagent = <span class="built_in">require</span>(<span class="string">"superagent"</span>);</div><div class="line"><span class="keyword">var</span> eventproxy = <span class="built_in">require</span>(<span class="string">"eventproxy"</span>);</div></pre></td></tr></table></figure></p>
<p>运行<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">webpack test.js</div></pre></td></tr></table></figure></p>
<p>在我的2015款RMBP13，i5处理器，全SSD下，性能是这样的：</p>
<p>没错你没有看错，这几个第三方轮子加起来有整整668个模块，全部打包需要20多秒。</p>
<p>这意味着什么呢？你每次对业务代码的修改，gulp 或者 Webpack 监测到后都会重新打包，你要足足等20秒才能看到自己的修改结果。</p>
<p>但是需要重新打包的只有你的业务代码，这些第三方库是完全不用重新打包的，它们的存在只会拖累打包性能。所以我们要找一些方法来优化这个过程。</p>
<h2 id="配置externals"><a href="#配置externals" class="headerlink" title="配置externals"></a>配置externals</h2><p>Webpack 可以配置 externals 来将依赖的库指向全局变量，从而不再打包这个库，比如对于这样一个文件：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</div><div class="line"><span class="built_in">console</span>.log(React);</div><div class="line">如果你在 Webpack.config.js 中配置了externals：</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">    <span class="attr">externals</span>: &#123;</div><div class="line">        <span class="string">'react'</span>: <span class="string">'window.React'</span></div><div class="line">    &#125;</div><div class="line">    <span class="comment">//其它配置忽略......</span></div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>等于让 Webpack 知道，对于 react 这个模块就不要打包啦，直接指向 window.React 就好。不过别忘了加载 react.min.js，让全局中有 React 这个变量。</p>
<p>我们来看看性能，因为不用打包 React 了所以速度自然超级快，包也很小：</p>
<h2 id="配置externals的缺陷"><a href="#配置externals的缺陷" class="headerlink" title="配置externals的缺陷"></a>配置externals的缺陷</h2><p>问题如果就这么简单地解决了的话，那我就没必要写这篇文章了，下面我们加一个 react 的动画库 react-addons-css-transition-group 来试一试：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</div><div class="line"><span class="keyword">import</span> ReactAddonsCssTransitionGroup <span class="keyword">from</span> <span class="string">'react-addons-css-transition-group'</span>;</div><div class="line"><span class="built_in">console</span>.log(React);</div></pre></td></tr></table></figure></p>
<p>对，你没有看错，我也没有截错图，新加了一个很小很小的动画库之后，性能又爆炸了。从模块数来看，一定是 Webpack 又把 react 重新打包了一遍。</p>
<p>我们来看一下为什么一个很小很小的动画库会导致 Webpack 又傻傻地把 react 重新打包了一遍。找到 react-addons-css-transition-group 这个模块，然后看看它是怎么写的：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// react-addons-css-transition-group模块</span></div><div class="line"><span class="comment">// 入口文件 index.js</span></div><div class="line"><span class="built_in">module</span>.exports = <span class="built_in">require</span>(<span class="string">'react/lib/ReactCSSTransitionGroup'</span>);</div><div class="line">这个动画模块就只有一行代码，唯一的作用就是指向 react 下面的一个子模块，我们再来看看这个子模块是怎么写的：</div><div class="line"></div><div class="line"><span class="comment">// react模块</span></div><div class="line"><span class="comment">// react/lib/ReactCSSTransitionGroup.js</span></div><div class="line"><span class="keyword">var</span> React = <span class="built_in">require</span>(<span class="string">'./React'</span>);</div><div class="line"><span class="keyword">var</span> ReactTransitionGroup = <span class="built_in">require</span>(<span class="string">'./ReactTransitionGroup'</span>);</div><div class="line"><span class="keyword">var</span> ReactCSSTransitionGroupChild = <span class="built_in">require</span>(<span class="string">'./ReactCSSTransitionGroupChild'</span>);</div><div class="line"><span class="comment">//....剩余代码忽略</span></div></pre></td></tr></table></figure></p>
<p>这个子模块又反回去依赖了 react 整个库的入口，这就是拖累 Webpack 的罪魁祸首。</p>
<p>总而言之，问题是这样产生的：</p>
<p>Webpack 发现我们依赖了 react-addons-css-transition-group<br>Webpack 去打包 react-addons-css-transition-group 的时候发现它依赖了 react 模块下的一个叫 ReactTransitionGroup.js 的文件，于是 Webpack 去打包这个文件。<br>ReactTransitionGroup.js 依赖了整个 react 的入口文件 React.js，虽然我们设置了 externals ，但是 Webpack 不知道这个入口文件等效于 react 模块本身，于是我们可爱又敬业的 Webpack 就把整个 react 又重新打包了一遍。<br>读到这里你可能会有疑问，为什么不能把这个动画库也设置到 externals 里，这样不是就不用打包了吗？</p>
<p>问题就在于，这个动画库并没有提供生产环境的文件，或者说这个库根本没有提供 react-addons-css-transition-group.min.js 这个文件。</p>
<p>这个问题不只存在于 react-addons-css-transition-group 中，对于 react 的大多数现有库来说都有这个依赖关系复杂的问题。</p>
<h2 id="初级解决方法"><a href="#初级解决方法" class="headerlink" title="初级解决方法"></a>初级解决方法</h2><p>所以对于这个问题的解决方法就是，手工打包这些 module，然后设置 externals ，让 Webpack 不再打包它们。</p>
<p>我们需要这样一个 lib-bundle.js 文件：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">window</span>.__LIB[<span class="string">"react"</span>] = <span class="built_in">require</span>(<span class="string">"react"</span>);</div><div class="line"><span class="built_in">window</span>.__LIB[<span class="string">"react-addons-css-transition-group"</span>] = <span class="built_in">require</span>(<span class="string">"react-addons-css-transition-group"</span>);</div><div class="line"><span class="comment">// ...其它依赖包</span></div></pre></td></tr></table></figure></p>
<p>我们在这里把一些第三方库注册到了 window.__LIB 下，这些库可以作为底层的基础库，免于重复打包。</p>
<p>然后执行 webpack lib-bundle.js lib.js，得到打包好的 lib.js。然后去设置我们的 externals ：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</div><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">    <span class="attr">externals</span>: &#123;</div><div class="line">        <span class="string">'react'</span>: <span class="string">'window.__LIB["react"]'</span>,</div><div class="line">        <span class="string">'react-addons-css-transition-group'</span>: <span class="string">'window.__LIB["react-addons-css-transition-group"]'</span>,</div><div class="line">        <span class="comment">// 其它库</span></div><div class="line">    &#125;</div><div class="line">    <span class="comment">//其它配置忽略......</span></div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>这时由于 externals 的存在，Webpack 打包的时候就会避开这些模块超多，依赖关系复杂的库，把这些第三方 module 的入口指向预先打包好的 lib.js 的入口 window.__LIB，从而只打包我们的业务代码。</p>
<h2 id="终极解决方法"><a href="#终极解决方法" class="headerlink" title="终极解决方法"></a>终极解决方法</h2><p>上面我们提到的方法本质上就是一种动态链接库（dll）”的思想，这在 windows 系统下面是一种很常见的思想。一个dll包，就是一个很纯净的依赖库，它本身不能运行，是用来给你的 app 或者业务代码引用的。</p>
<p>同样的 Webpack 最近也新加入了这个功能：webpack.DllPlugin。使用这个功能需要把打包过程分成两步：</p>
<p>打包ddl包<br>引用ddl包，打包业务代码<br>首先我们来打包ddl包，首先配置一个这样的 ddl.config.js：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</div><div class="line"></div><div class="line"><span class="keyword">const</span> vendors = [</div><div class="line">    <span class="string">'react'</span>,</div><div class="line">    <span class="string">'react-dom'</span>,</div><div class="line">    <span class="string">'react-router'</span>,</div><div class="line">    <span class="comment">// ...其它库</span></div><div class="line">];</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">    <span class="attr">output</span>: &#123;</div><div class="line">        <span class="attr">path</span>: <span class="string">'build'</span>,</div><div class="line">        <span class="attr">filename</span>: <span class="string">'[name].js'</span>,</div><div class="line">        <span class="attr">library</span>: <span class="string">'[name]'</span>,</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">entry</span>: &#123;</div><div class="line">        <span class="string">"lib"</span>: vendors,</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">plugins</span>: [</div><div class="line">        <span class="keyword">new</span> webpack.DllPlugin(&#123;</div><div class="line">            <span class="attr">path</span>: <span class="string">'manifest.json'</span>,</div><div class="line">            <span class="attr">name</span>: <span class="string">'[name]'</span>,</div><div class="line">            <span class="attr">context</span>: __dirname,</div><div class="line">        &#125;),</div><div class="line">    ],</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>webpack.DllPlugin 的选项中：</p>
<p>path 是 manifest.json 文件的输出路径，这个文件会用于后续的业务代码打包；<br>name 是dll暴露的对象名，要跟 output.library 保持一致；<br>context 是解析包路径的上下文，这个要跟接下来配置的 webpack.config.js 一致。<br>运行Webpack，会输出两个文件一个是打包好的 lib.js，一个就是 manifest.json，它里面的内容大概是这样的：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="string">"name"</span>: <span class="string">"vendor_ac51ba426d4f259b8b18"</span>,</div><div class="line">    <span class="string">"content"</span>: &#123;</div><div class="line">        <span class="string">"./node_modules/react/react.js"</span>: <span class="number">1</span>,</div><div class="line">        <span class="string">"./node_modules/react/lib/React.js"</span>: <span class="number">2</span>,</div><div class="line">        <span class="string">"./node_modules/react/node_modules/object-assign/index.js"</span>: <span class="number">3</span>,</div><div class="line">        <span class="string">"./node_modules/react/lib/ReactChildren.js"</span>: <span class="number">4</span>,</div><div class="line">        <span class="string">"./node_modules/react/lib/PooledClass.js"</span>: <span class="number">5</span>,</div><div class="line">        <span class="string">"./node_modules/react/lib/reactProdInvariant.js"</span>: <span class="number">6</span>,</div><div class="line">        <span class="comment">// ............</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>接下来我们就可以快乐地打包业务代码啦，首先写好打包配置文件 webpack.config.js：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</div><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">    <span class="attr">output</span>: &#123;</div><div class="line">        <span class="attr">path</span>: <span class="string">'build'</span>,</div><div class="line">        <span class="attr">filename</span>: <span class="string">'[name].js'</span>,</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">entry</span>: &#123;</div><div class="line">        <span class="attr">app</span>: <span class="string">'./src/index.js'</span>,</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">plugins</span>: [</div><div class="line">        <span class="keyword">new</span> webpack.DllReferencePlugin(&#123;</div><div class="line">            <span class="attr">context</span>: __dirname,</div><div class="line">            <span class="attr">manifest</span>: <span class="built_in">require</span>(<span class="string">'./manifest.json'</span>),</div><div class="line">        &#125;),</div><div class="line">    ],</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>webpack.DllReferencePlugin 的选项中：</p>
<p>context 需要跟之前保持一致，这个用来指导 Webpack 匹配 manifest 中库的路径；<br>manifest 用来引入刚才输出的 manifest.json 文件。<br>DllPlugin 本质上的做法和我们手动分离这些第三方库是一样的，但是对于包极多的应用来说，自动化明显加快了生产效率。</p>
<p>PS:<br>其实还有一个速度的优化点，就是配置babel，让它排除一些文件，当loader这些文件时不进行转换，自动跳过；可在.babelrc文件中配置，示例：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="string">"presets"</span>: [</div><div class="line">        <span class="string">"es2015"</span></div><div class="line">    ],</div><div class="line">    <span class="string">"ignore"</span>:[</div><div class="line">        <span class="string">"jquery.js"</span>,</div><div class="line">        <span class="string">"jquery.min.js"</span>,</div><div class="line">        <span class="string">"angular.js"</span>,</div><div class="line">        <span class="string">"angular.min.js"</span>,</div><div class="line">        <span class="string">"bootstrap.js"</span>,</div><div class="line">        <span class="string">"bootstrap.min.js"</span></div><div class="line">    ]</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="Mr.Hua" />
          <p class="site-author-name" itemprop="name">Mr.Hua</p>
          <p class="site-description motion-element" itemprop="description">About My Work Daily</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">21</span>
              <span class="site-state-item-name">Artikel</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">12</span>
                <span class="site-state-item-name">Kategorien</span>
              
            </div>
          

          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Mr.Hua</span>
</div>


<div class="powered-by">
  Erstellt mit  <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	




  
  

  

  

  

  


</body>
</html>
